<!DOCTYPE html>
<html>
<head>
    <title>Debug LocalStorage - Anamnese Pro</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .section { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; }
        h2 { color: #333; border-bottom: 2px solid #ddd; padding-bottom: 5px; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>ğŸ” Debug LocalStorage - Anamnese Pro</h1>

    <div class="section">
        <h2>ğŸ“Š ConfiguraÃ§Ã£o Atual</h2>
        <pre id="config"></pre>
    </div>

    <div class="section">
        <h2>ğŸ‘¥ Clientes Cadastrados</h2>
        <pre id="clientes"></pre>
    </div>

    <div class="section">
        <h2>ğŸ“‹ Anamneses Cadastradas</h2>
        <pre id="anamneses"></pre>
    </div>

    <div class="section">
        <h2>ğŸ” AnÃ¡lise do Problema</h2>
        <pre id="analise"></pre>
    </div>

    <script>
        // Ler localStorage
        const config = JSON.parse(localStorage.getItem('anamneseConfig') || '{}');
        const clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
        const anamneses = JSON.parse(localStorage.getItem('anamneses') || '[]');

        // Mostrar configuraÃ§Ã£o
        document.getElementById('config').textContent = JSON.stringify(config, null, 2);

        // Mostrar clientes
        let clientesOutput = `Total de clientes: ${clientes.length}\n\n`;
        clientes.forEach((c, i) => {
            clientesOutput += `Cliente ${i + 1}:\n`;
            clientesOutput += `  Nome: ${c.nome}\n`;
            clientesOutput += `  CPF: ${c.cpf}\n`;
            clientesOutput += `  ProfissÃ£o: ${c.profissao || 'NÃƒO DEFINIDA âš ï¸'}\n`;
            clientesOutput += `  Total Anamneses: ${c.totalAnamneses}\n`;
            clientesOutput += `\n`;
        });
        document.getElementById('clientes').textContent = clientesOutput;

        // Mostrar anamneses
        let anamnesesOutput = `Total de anamneses: ${anamneses.length}\n\n`;
        anamneses.forEach((a, i) => {
            anamnesesOutput += `Anamnese ${i + 1}:\n`;
            anamnesesOutput += `  Cliente: ${a.clienteNome}\n`;
            anamnesesOutput += `  Status: ${a.status}\n`;
            anamnesesOutput += `  ProfissÃ£o: ${a.profissao || 'NÃƒO DEFINIDA âš ï¸'}\n`;
            anamnesesOutput += `  Preenchido por: ${a.preenchidoPor}\n`;
            anamnesesOutput += `\n`;
        });
        document.getElementById('anamneses').textContent = anamnesesOutput;

        // AnÃ¡lise
        let analise = '';
        const profissaoAtual = config.templateProfissao || 'tatuagem';
        analise += `ğŸ¯ PROFISSÃƒO CONFIGURADA: ${profissaoAtual}\n\n`;

        // Contar clientes por profissÃ£o
        const clientesPorProfissao = {};
        clientes.forEach(c => {
            const prof = c.profissao || 'sem-profissao';
            clientesPorProfissao[prof] = (clientesPorProfissao[prof] || 0) + 1;
        });

        analise += `ğŸ‘¥ CLIENTES POR PROFISSÃƒO:\n`;
        Object.keys(clientesPorProfissao).forEach(prof => {
            analise += `  ${prof}: ${clientesPorProfissao[prof]} clientes\n`;
        });

        // Contar anamneses por profissÃ£o
        const anamnesesPorProfissao = {};
        anamneses.forEach(a => {
            const prof = a.profissao || 'sem-profissao';
            anamnesesPorProfissao[prof] = (anamnesesPorProfissao[prof] || 0) + 1;
        });

        analise += `\nğŸ“‹ ANAMNESES POR PROFISSÃƒO:\n`;
        Object.keys(anamnesesPorProfissao).forEach(prof => {
            analise += `  ${prof}: ${anamnesesPorProfissao[prof]} anamneses\n`;
        });

        // Verificar inconsistÃªncias
        analise += `\nğŸ” VERIFICAÃ‡ÃƒO:\n`;

        const clientesFisio = clientes.filter(c => c.profissao === 'fisioterapia').length;
        const anamnesesFisio = anamneses.filter(a => a.profissao === 'fisioterapia').length;

        if (anamnesesFisio > 0 && clientesFisio === 0) {
            analise += `  âŒ PROBLEMA DETECTADO!\n`;
            analise += `  ${anamnesesFisio} anamnese(s) de fisioterapia\n`;
            analise += `  MAS ${clientesFisio} clientes de fisioterapia!\n\n`;
            analise += `  PossÃ­veis causas:\n`;
            analise += `  1. Cliente foi salvo sem o campo 'profissao'\n`;
            analise += `  2. Cliente foi salvo com profissÃ£o diferente\n`;
            analise += `  3. Filtro estÃ¡ bloqueando o cliente\n`;
        } else if (anamnesesFisio === clientesFisio && anamnesesFisio > 0) {
            analise += `  âœ… DADOS CONSISTENTES!\n`;
            analise += `  ${anamnesesFisio} anamnese(s) de fisioterapia\n`;
            analise += `  ${clientesFisio} cliente(s) de fisioterapia\n`;
        } else if (anamnesesFisio === 0) {
            analise += `  â„¹ï¸ Nenhuma anamnese de fisioterapia encontrada\n`;
        }

        document.getElementById('analise').textContent = analise;
    </script>
</body>
</html>
