import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '../ui/card';
import { Progress } from '../ui/progress';
import { ChevronLeft, ChevronRight, FileText, MapPin, Heart, AlertCircle, Sparkles, Image as ImageIcon, CheckCircle, X } from 'lucide-react';
import { getTemplateAtivo } from '../../utils/templateHelpers';
import { Template } from '../../types/templates';
import { TemplateQuizRenderer } from './TemplateQuizRenderer';

// Tipos
interface QuizData {
  nomeCompleto: string;
  dataNascimento: string;
  cpf: string;
  telefone: string;
  email: string;
  // Campos de endere√ßo
  cep: string;
  rua: string;
  numero: string;
  complemento?: string;
  bairro: string;
  cidade: string;
  estado: string;
  endereco: string; // Mantido para compatibilidade (ser√° gerado automaticamente)
  comoConheceu: string;
  outraOrigem?: string;
  doencas: string;
  medicamentos: string;
  temAlergias: boolean;
  alergias?: string;
  condicoesPele: string;
  temTatuagem: boolean;
  historicoTatuagens?: string;
  localTatuagem: string;
  tamanhoTatuagem: string;
  estiloTatuagem: string;
  valorTatuagem: number; // NOVO: Valor cobrado pela tatuagem

  // ========== CAMPOS DE NUTRI√á√ÉO ==========
  objetivoNutricional?: string; // Emagrecimento, Ganho de massa, etc
  pesoAtual?: string;
  altura?: string;
  imc?: string; // Calculado automaticamente
  historicoEmagrecimento?: string;
  quantasRefeicoes?: string;
  alimentosGosta?: string;
  alimentosEvita?: string;
  restricaoAlimentar?: string; // Vegetariano, Vegano, etc
  intoleranciaAlergia?: string;
  litrosAgua?: string;
  atividadeFisica?: string;
  qualidadeSono?: string;
  horasSono?: string;
  funcionamentoIntestinal?: string;
  consumoAlcool?: string;
  doencasCondicoes?: string;
  usoSuplementos?: string;
  examesRecentes?: string;
  expectativasNutricao?: string;

  // ========== CAMPOS DE PSICOLOGIA ==========
  faixaEtaria?: string; // Faixa et√°ria do paciente
  motivoBusca?: string; // Por que est√° buscando terapia?
  queixaPrincipal?: string; // Qual a queixa principal?
  sintomas?: string; // Sintomas que tem sentido
  historicoTratamento?: string; // J√° fez terapia antes?
  medicamentosUso?: string; // Medicamentos psiqui√°tricos
  historiaFamiliar?: string; // Hist√≥rico familiar de problemas mentais
  eventosSignificativos?: string; // Eventos marcantes na vida
  apoioSocial?: string; // Rede de apoio (fam√≠lia, amigos)
  objetivosTerapia?: string; // O que espera da terapia?
  expectativasPsicologia?: string; // Expectativas gerais

  // ========== CAMPOS DE FISIOTERAPIA ==========
  motivoConsultaFisio?: string; // Motivo principal da consulta
  quandoComecou?: string; // Quando come√ßou o problema
  oQueEstavaFazendo?: string; // O que estava fazendo quando come√ßou
  localizacaoDor?: string; // Localiza√ß√£o da dor/desconforto
  intensidadeDor?: string; // Intensidade da dor (0-10)
  tipoDor?: string; // Tipo de dor (aguda, cr√¥nica, latejante, etc.)
  oQuePioraDor?: string; // O que piora a dor
  oQueMelhoraDor?: string; // O que melhora a dor
  jafezFisioterapia?: string; // J√° fez fisioterapia antes?
  historicoCirurgias?: string; // Hist√≥rico de cirurgias ortop√©dicas
  medicamentosDor?: string; // Medicamentos para dor
  doencasCronicas?: string; // Doen√ßas cr√¥nicas
  atividadeFisicaFisio?: string; // Pr√°tica de atividades f√≠sicas
  limitacoesMovimento?: string; // Limita√ß√µes de movimento
  usoOrteses?: string; // Uso de √≥rteses/pr√≥teses/auxiliares
  profissaoAtividades?: string; // Profiss√£o e atividades di√°rias
  objetivosFisioterapia?: string; // Objetivos com a fisioterapia

  // ========== CAMPOS DE EST√âTICA ==========
  procedimentoDesejado?: string; // Qual procedimento deseja realizar
  tipoPele?: string; // Tipo de pele (oleosa, seca, mista, sens√≠vel)
  problemaPele?: string; // Problemas de pele (acne, manchas, rugas, etc)
  exposicaoSol?: string; // Exposi√ß√£o ao sol
  usaProtetorSolar?: string; // Usa protetor solar?
  cuidadosPele?: string; // Rotina de cuidados com a pele
  alergiasCosmeticos?: string; // Alergias a cosm√©ticos/produtos
  cirurgiasEsteticas?: string; // Hist√≥rico de cirurgias est√©ticas
  procedimentosAnteriores?: string; // Procedimentos est√©ticos anteriores
  usaMedicamentoPele?: string; // Medicamentos para a pele
  cicatrizacao?: string; // Como √© sua cicatriza√ß√£o?
  expectativasProcedimento?: string; // Expectativas com o procedimento
  gestanteAmamentando?: string; // Est√° gestante ou amamentando?
  objetivosEstetica?: string; // Objetivos principais

  // ========== CAMPOS DE CONSULTORIA ==========
  categoriaInteresse?: string; // Categoria de interesse do cliente
  objetivoCompra?: string; // Objetivo da compra
  jaComprouAntes?: string; // J√° comprou antes?
  produtosInteresse?: string; // Produtos/servi√ßos de interesse
  frequenciaCompra?: string; // Frequ√™ncia de compra estimada
  faixaInvestimento?: string; // Faixa de investimento mensal
  preferenciasContato?: string; // Prefer√™ncias de contato (WhatsApp, Email, etc)
  observacoesGerais?: string; // Observa√ß√µes gerais

  // ========== DATA DA ANAMNESE ==========
  dataAnamnese: string; // Data em que a anamnese foi realizada

  aceitaTermo: boolean;
  assinatura: string;

  // ========== TEMPLATE CUSTOMIZADO ==========
  respostasCustomizadas?: Record<string, string | boolean | string[]>; // Respostas das perguntas customizadas
  templateUsadoId?: string | null; // ID do template usado
  perguntasSnapshot?: any[]; // Snapshot das perguntas (caso template seja editado depois)
}

interface QuizContainerProps {
  mode: 'presencial' | 'remoto';
  onComplete: (data: QuizData) => void;
  onClose: () => void;
  customQuestions?: any[]; // Perguntas personalizadas do template
  initialData?: any; // Dados pr√©-preenchidos (da √∫ltima anamnese)
}

export function QuizContainer({ mode, onComplete, onClose, customQuestions = [], initialData = null }: QuizContainerProps) {
  const [currentStep, setCurrentStep] = useState(initialData ? 7 : 1); // Se tem dados, come√ßa no Step 7 (tatuagem)

  // Inicializar com data de hoje se n√£o tiver dados pr√©-preenchidos
  const dataHoje = new Date().toISOString().split('T')[0]; // Formato: YYYY-MM-DD
  const [formData, setFormData] = useState<Partial<QuizData>>(
    initialData
      ? { ...initialData, dataAnamnese: initialData.dataAnamnese || dataHoje }
      : { dataAnamnese: dataHoje }
  );

  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({}); // Erros de valida√ß√£o
  const [valorFormatado, setValorFormatado] = useState('0,00'); // Valor formatado para exibi√ß√£o

  // üìù TEMPLATE ATIVO E RESPOSTAS CUSTOMIZADAS
  const [templateAtivo, setTemplateAtivo] = useState<Template | null>(null);
  const [respostasCustomizadas, setRespostasCustomizadas] = useState<Record<string, string | boolean | string[]>>({});

  // Carregar template ativo quando o componente montar
  useEffect(() => {
    const config = localStorage.getItem('anamneseConfig');
    const profissaoAtual = config ? JSON.parse(config).templateProfissao : 'tatuagem';
    const template = getTemplateAtivo(profissaoAtual);
    if (template) {
      setTemplateAtivo(template);
    }
  }, []);

  // üé® OBTER CORES TEM√ÅTICAS DA PROFISS√ÉO
  const getCoresTema = () => {
    const config = localStorage.getItem('anamneseConfig');
    const templateProfissao = config ? JSON.parse(config).templateProfissao : 'tatuagem';

    const cores: any = {
      tatuagem: {
        gradient: 'from-pink-500 to-purple-500',
        bg50: 'bg-pink-50',
        border200: 'border-pink-200',
        border300: 'border-pink-300',
        border500: 'border-pink-500',
        text500: 'text-pink-500',
        focus: 'focus:border-pink-500',
        hover: 'hover:border-pink-300',
        hoverBg: 'hover:bg-pink-50/50',
      },
      psicologia: {
        gradient: 'from-blue-500 to-cyan-500',
        bg50: 'bg-blue-50',
        border200: 'border-blue-200',
        border300: 'border-blue-300',
        border500: 'border-blue-500',
        text500: 'text-blue-500',
        focus: 'focus:border-blue-500',
        hover: 'hover:border-blue-300',
        hoverBg: 'hover:bg-blue-50/50',
      },
      nutricao: {
        gradient: 'from-green-500 to-emerald-500',
        bg50: 'bg-green-50',
        border200: 'border-green-200',
        border300: 'border-green-300',
        border500: 'border-green-500',
        text500: 'text-green-500',
        focus: 'focus:border-green-500',
        hover: 'hover:border-green-300',
        hoverBg: 'hover:bg-green-50/50',
      },
      fisioterapia: {
        gradient: 'from-orange-500 to-amber-500',
        bg50: 'bg-orange-50',
        border200: 'border-orange-200',
        border300: 'border-orange-300',
        border500: 'border-orange-500',
        text500: 'text-orange-500',
        focus: 'focus:border-orange-500',
        hover: 'hover:border-orange-300',
        hoverBg: 'hover:bg-orange-50/50',
      },
      estetica: {
        gradient: 'from-purple-500 to-fuchsia-500',
        bg50: 'bg-purple-50',
        border200: 'border-purple-200',
        border300: 'border-purple-300',
        border500: 'border-purple-500',
        text500: 'text-purple-500',
        focus: 'focus:border-purple-500',
        hover: 'hover:border-purple-300',
        hoverBg: 'hover:bg-purple-50/50',
      },
      consultoria: {
        gradient: 'from-indigo-500 to-purple-500',
        bg50: 'bg-indigo-50',
        border200: 'border-indigo-200',
        border300: 'border-indigo-300',
        border500: 'border-indigo-500',
        text500: 'text-indigo-500',
        focus: 'focus:border-indigo-500',
        hover: 'hover:border-indigo-300',
        hoverBg: 'hover:bg-indigo-50/50',
      },
    };
    return cores[templateProfissao] || cores.tatuagem;
  };

  const coresTema = getCoresTema();

  // Log para verificar se as perguntas personalizadas chegaram
  console.log('üéØ Custom Questions recebidas no QuizContainer:', customQuestions);

  // Log e useEffect para dados pr√©-preenchidos
  useEffect(() => {
    if (initialData) {
      console.log('üìã Dados pr√©-preenchidos recebidos:', initialData);
      console.log('‚è≠Ô∏è Pulando para Step 7 (informa√ß√µes da nova tatuagem)');
      // Limpar dados espec√≠ficos da tatuagem anterior + assinatura
      setFormData({
        ...initialData,
        localTatuagem: '', // Limpar local da tatuagem anterior
        tamanhoTatuagem: '', // Limpar tamanho
        estiloTatuagem: '', // Limpar estilo
        assinatura: '', // Limpar assinatura
        aceitaTermo: false, // Limpar termo
      });
      setCurrentStep(7); // Ir direto para Step 7
    }
  }, [initialData]);

  // Fun√ß√µes de valida√ß√£o
  const validateEmail = (email: string): string | null => {
    if (!email) return 'Email √© obrigat√≥rio';
    if (!email.includes('@')) return 'Email deve conter @';
    if (!email.includes('.')) return 'Email inv√°lido';
    return null; // null = sem erro
  };

  const validatePhone = (phone: string): string | null => {
    if (!phone) return 'Telefone √© obrigat√≥rio';
    const numbers = phone.replace(/\D/g, ''); // Remove tudo que n√£o √© n√∫mero
    if (numbers.length < 10 || numbers.length > 11) {
      return 'Telefone deve ter 10 ou 11 d√≠gitos';
    }
    return null;
  };

  const validateCPF = (cpf: string): string | null => {
    if (!cpf) return 'CPF √© obrigat√≥rio';
    const numbers = cpf.replace(/\D/g, '');
    if (numbers.length !== 11) return 'CPF deve ter 11 d√≠gitos';
    return null;
  };

  // Fun√ß√£o para buscar endere√ßo pelo CEP usando ViaCEP
  const buscarCEP = async (cep: string) => {
    const cepLimpo = cep.replace(/\D/g, ''); // Remove tudo que n√£o √© n√∫mero

    if (cepLimpo.length !== 8) {
      return; // CEP inv√°lido, n√£o busca
    }

    try {
      const response = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
      const data = await response.json();

      if (data.erro) {
        alert('CEP n√£o encontrado!');
        return;
      }

      // Preencher campos automaticamente
      updateFormData({
        cep: cepLimpo,
        rua: data.logradouro || '',
        bairro: data.bairro || '',
        cidade: data.localidade || '',
        estado: data.uf || '',
        // Gerar endere√ßo completo para compatibilidade
        endereco: `${data.logradouro}, ${data.bairro} - ${data.localidade}/${data.uf}`,
      });

      // Dar foco no campo de n√∫mero
      setTimeout(() => {
        const numeroInput = document.querySelector('input[placeholder="N√∫mero"]') as HTMLInputElement;
        if (numeroInput) numeroInput.focus();
      }, 100);
    } catch (error) {
      console.error('Erro ao buscar CEP:', error);
      alert('Erro ao buscar CEP. Tente novamente.');
    }
  };

  // Fun√ß√£o para formatar valor como moeda brasileira (estilo banco)
  const formatarMoeda = (valor: string): { formatado: string; valorNumerico: number } => {
    // Remove tudo que n√£o √© n√∫mero
    const apenasNumeros = valor.replace(/\D/g, '');

    // Se vazio, retorna 0,00
    if (!apenasNumeros || apenasNumeros === '0') {
      return { formatado: '0,00', valorNumerico: 0 };
    }

    // Converte para n√∫mero (centavos)
    const valorEmCentavos = parseInt(apenasNumeros);
    const valorEmReais = valorEmCentavos / 100;

    // Formata com v√≠rgula e ponto
    const formatado = valorEmReais.toLocaleString('pt-BR', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    });

    return { formatado, valorNumerico: valorEmReais };
  };

  // Handler para mudan√ßa de valor
  const handleValorChange = (input: string) => {
    const { formatado, valorNumerico } = formatarMoeda(input);
    setValorFormatado(formatado);
    updateFormData({ valorTatuagem: valorNumerico });
  };

  // Se tem perguntas personalizadas, usar elas. Sen√£o, usar quiz padr√£o
  const useCustomQuiz = customQuestions.length > 0;

  // Agrupar perguntas por se√ß√£o (para criar os steps)
  const groupedQuestions = useCustomQuiz ? customQuestions.reduce((acc: any, question: any) => {
    if (!acc[question.section]) {
      acc[question.section] = [];
    }
    acc[question.section].push(question);
    return acc;
  }, {}) : {};

  const sections = Object.keys(groupedQuestions);
  // SEMPRE incluir +2 steps: 1 para Data da Anamnese + 1 para Termo de Compromisso
  // NUTRI√á√ÉO: 8 steps (1 dados pessoais + 5 perguntas + 1 data + 1 termo) - pula o Step 2 "Como conheceu"
  // TATUAGEM: 9 steps (1 dados pessoais + 1 como conheceu + 5 perguntas + 1 data + 1 termo)
  // PSICOLOGIA: 7 steps (1 dados pessoais + 4 perguntas + 1 data + 1 termo)
  // FISIOTERAPIA: 8 steps (1 dados pessoais + 5 perguntas + 1 data + 1 termo)
  // EST√âTICA: 8 steps (1 dados pessoais + 5 perguntas + 1 data + 1 termo)
  // CONSULTORIA: 6 steps (1 dados pessoais + 3 perguntas + 1 data + 1 termo)
  const profissao = localStorage.getItem('anamneseConfig') ? JSON.parse(localStorage.getItem('anamneseConfig')!).templateProfissao : 'tatuagem';
  const totalSteps = useCustomQuiz ? sections.length + 2 : (profissao === 'nutricao' ? 8 : profissao === 'psicologia' ? 7 : profissao === 'fisioterapia' ? 8 : profissao === 'estetica' ? 8 : profissao === 'consultoria' ? 6 : 9);
  const progress = (currentStep / totalSteps) * 100;

  const handleNext = () => {
    const errors: Record<string, string> = {};

    // Se est√° usando quiz customizado, valida baseado nas perguntas configuradas
    if (useCustomQuiz) {
      const currentSection = sections[currentStep - 1];
      const currentQuestions = groupedQuestions[currentSection];

      currentQuestions.forEach((question: any) => {
        if (question.required) {
          const fieldKey = question.label.toLowerCase().replace(/\s+/g, '_');
          const value = (formData as any)[fieldKey];

          if (!value || value === '') {
            errors[fieldKey] = `${question.label} √© obrigat√≥rio`;
          }

          // Valida√ß√µes espec√≠ficas por tipo de campo
          if (question.label.toLowerCase().includes('email') && value) {
            const emailError = validateEmail(value);
            if (emailError) errors[fieldKey] = emailError;
          }

          if (question.label.toLowerCase().includes('telefone') && value) {
            const phoneError = validatePhone(value);
            if (phoneError) errors[fieldKey] = phoneError;
          }

          if (question.label.toLowerCase().includes('cpf') && value) {
            const cpfError = validateCPF(value);
            if (cpfError) errors[fieldKey] = cpfError;
          }
        }
      });
    } else {
      // Valida√ß√£o do quiz padr√£o (quando n√£o tem perguntas customizadas)
      if (currentStep === 1) {
        // Nome obrigat√≥rio
        if (!formData.nomeCompleto) errors.nomeCompleto = 'Nome √© obrigat√≥rio';

        // Email obrigat√≥rio e v√°lido
        const emailError = validateEmail(formData.email || '');
        if (emailError) errors.email = emailError;

        // Telefone obrigat√≥rio e v√°lido
        const phoneError = validatePhone(formData.telefone || '');
        if (phoneError) errors.telefone = phoneError;

        // CPF obrigat√≥rio e v√°lido
        const cpfError = validateCPF(formData.cpf || '');
        if (cpfError) errors.cpf = cpfError;

        // Data de nascimento obrigat√≥ria
        if (!formData.dataNascimento) {
          errors.dataNascimento = 'Data de nascimento √© obrigat√≥ria';
        } else {
          // Validar idade m√≠nima de 18 anos APENAS para tatuagem
          if (profissao === 'tatuagem') {
            const hoje = new Date();
            const nascimento = new Date(formData.dataNascimento);
            let idade = hoje.getFullYear() - nascimento.getFullYear();
            const mes = hoje.getMonth() - nascimento.getMonth();
            if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
              idade--;
            }

            if (idade < 18) {
              errors.dataNascimento = '‚ö†Ô∏è Voc√™ precisa ter 18 anos ou mais para fazer tatuagem';
            }
          }
        }

        // Valida√ß√£o de endere√ßo
        if (!formData.cep) errors.cep = 'CEP √© obrigat√≥rio';
        if (!formData.rua) errors.rua = 'Rua √© obrigat√≥ria';
        if (!formData.numero) errors.numero = 'N√∫mero √© obrigat√≥rio';
        if (!formData.bairro) errors.bairro = 'Bairro √© obrigat√≥rio';
        if (!formData.cidade) errors.cidade = 'Cidade √© obrigat√≥ria';
        if (!formData.estado) errors.estado = 'UF √© obrigat√≥ria';

        // Gerar endere√ßo completo para compatibilidade
        if (formData.rua && formData.numero && formData.bairro && formData.cidade && formData.estado) {
          const enderecoCompleto = formData.complemento
            ? `${formData.rua}, ${formData.numero} - ${formData.complemento}, ${formData.bairro} - ${formData.cidade}/${formData.estado}`
            : `${formData.rua}, ${formData.numero}, ${formData.bairro} - ${formData.cidade}/${formData.estado}`;
          updateFormData({ endereco: enderecoCompleto });
        }
      }

      // üìù Valida√ß√£o do Step 2 - Perguntas Customizadas do Template
      if (currentStep === 2 && templateAtivo && templateAtivo.perguntas.length > 0) {
        templateAtivo.perguntas.forEach((pergunta) => {
          if (pergunta.obrigatoria) {
            const resposta = respostasCustomizadas[pergunta.id];
            if (!resposta || resposta === '' || (Array.isArray(resposta) && resposta.length === 0)) {
              errors[pergunta.id] = 'Esta pergunta √© obrigat√≥ria';
            }
          }
        });
      }

      // Valida√ß√£o do Step 2 - Como conheceu (APENAS para tatuagem)
      if (currentStep === 2 && profissao === 'tatuagem' && (!templateAtivo || templateAtivo.perguntas.length === 0)) {
        if (!formData.comoConheceu) errors.comoConheceu = 'Selecione uma op√ß√£o';
        if (formData.comoConheceu === 'Outro' && !formData.outraOrigem) {
          errors.outraOrigem = 'Especifique como conheceu';
        }
      }

      // Valida√ß√£o do Step 2 - Psicologia (Faixa Et√°ria, Motivo e Queixa Principal)
      if (currentStep === 2 && profissao === 'psicologia') {
        if (!formData.faixaEtaria) errors.faixaEtaria = 'Selecione sua faixa et√°ria';
        if (!formData.motivoBusca) errors.motivoBusca = 'Selecione o motivo';
        if (!formData.queixaPrincipal) errors.queixaPrincipal = 'Descreva sua queixa principal';
      }

      // Valida√ß√£o do Step 5 - Psicologia (Objetivos)
      if (currentStep === 5 && profissao === 'psicologia') {
        if (!formData.objetivosTerapia) errors.objetivosTerapia = 'Descreva seus objetivos';
      }

      // Valida√ß√£o do Step 2 - Fisioterapia (Motivo da Consulta)
      if (currentStep === 2 && profissao === 'fisioterapia') {
        if (!formData.motivoConsultaFisio) errors.motivoConsultaFisio = 'Selecione o motivo da consulta';
        if (!formData.quandoComecou) errors.quandoComecou = 'Informe quando come√ßou o problema';
      }

      // Valida√ß√£o do Step 3 - Fisioterapia (Dor e Sintomas)
      if (currentStep === 3 && profissao === 'fisioterapia') {
        if (!formData.localizacaoDor) errors.localizacaoDor = 'Informe a localiza√ß√£o da dor';
        if (!formData.intensidadeDor) errors.intensidadeDor = 'Selecione a intensidade da dor';
      }

      // Valida√ß√£o do Step 6 - Fisioterapia (Objetivos)
      if (currentStep === 6 && profissao === 'fisioterapia') {
        if (!formData.objetivosFisioterapia) errors.objetivosFisioterapia = 'Descreva seus objetivos';
      }

      // ========== VALIDA√á√ïES DE EST√âTICA ==========
      // Valida√ß√£o do Step 2 - Est√©tica (Procedimento e Tipo de Pele)
      if (currentStep === 2 && profissao === 'estetica') {
        if (!formData.procedimentoDesejado) errors.procedimentoDesejado = 'Informe o procedimento desejado';
        if (!formData.tipoPele) errors.tipoPele = 'Selecione o tipo de pele';
      }

      // Valida√ß√£o do Step 3 - Est√©tica (Cuidados e Exposi√ß√£o Solar)
      if (currentStep === 3 && profissao === 'estetica') {
        if (!formData.exposicaoSol) errors.exposicaoSol = 'Informe a exposi√ß√£o ao sol';
        if (!formData.usaProtetorSolar) errors.usaProtetorSolar = 'Informe se usa protetor solar';
      }

      // Valida√ß√£o do Step 5 - Est√©tica (Medicamentos e Cicatriza√ß√£o)
      if (currentStep === 5 && profissao === 'estetica') {
        if (!formData.cicatrizacao) errors.cicatrizacao = 'Selecione o tipo de cicatriza√ß√£o';
        if (!formData.gestanteAmamentando) errors.gestanteAmamentando = 'Informe se est√° gestante ou amamentando';
      }

      // Valida√ß√£o do Step 6 - Est√©tica (Expectativas e Objetivos)
      if (currentStep === 6 && profissao === 'estetica') {
        if (!formData.expectativasProcedimento) errors.expectativasProcedimento = 'Descreva suas expectativas';
        if (!formData.objetivosEstetica) errors.objetivosEstetica = 'Descreva seus objetivos';
      }

      // ========== VALIDA√á√ïES DE CONSULTORIA ==========
      // Valida√ß√£o do Step 2 - Consultoria (Perfil do Cliente)
      if (currentStep === 2 && profissao === 'consultoria') {
        if (!formData.categoriaInteresse) errors.categoriaInteresse = 'Selecione a categoria de interesse';
        if (!formData.comoConheceu) errors.comoConheceu = 'Informe como conheceu';
      }

      // Valida√ß√£o do Step 3 - Consultoria (Prefer√™ncias e Hist√≥rico)
      if (currentStep === 3 && profissao === 'consultoria') {
        if (!formData.jaComprouAntes) errors.jaComprouAntes = 'Informe se j√° comprou antes';
      }

      // Valida√ß√£o do Step 4 - Consultoria (Observa√ß√µes e Prefer√™ncias)
      if (currentStep === 4 && profissao === 'consultoria') {
        if (!formData.faixaInvestimento) errors.faixaInvestimento = 'Selecione a faixa de investimento';
        if (!formData.preferenciasContato) errors.preferenciasContato = 'Selecione pelo menos uma prefer√™ncia de contato';
      }

      // Valida√ß√£o da Data da Anamnese (pen√∫ltimo step)
      if (currentStep === totalSteps - 1) {
        if (!formData.dataAnamnese) errors.dataAnamnese = 'Selecione a data da anamnese';
      }
    }

    // Se tem erros, N√ÉO avan√ßa e mostra os erros
    if (Object.keys(errors).length > 0) {
      setFieldErrors(errors);
      return; // Para aqui, n√£o avan√ßa
    }

    // Se n√£o tem erros, limpa erros anteriores e avan√ßa
    setFieldErrors({});
    if (currentStep < totalSteps) {
      setCurrentStep(currentStep + 1);
    }
  };

  const handlePrevious = () => {
    if (currentStep > 1) {
      setCurrentStep(currentStep - 1);
    }
  };

  const handleComplete = () => {
    // üéØ SALVAR RESPOSTAS CUSTOMIZADAS + ID DO TEMPLATE
    const dadosCompletos = {
      ...formData,
      // Salvar respostas das perguntas customizadas
      respostasCustomizadas: respostasCustomizadas,
      // Salvar ID do template usado
      templateUsadoId: templateAtivo?.id || null,
      // Salvar snapshot das perguntas (caso o template seja editado depois)
      perguntasSnapshot: templateAtivo?.perguntas || []
    };

    if (mode === 'remoto') {
      // Modo remoto: gerar link e mostrar para a profissional
      const uniqueLink = `https://anamnese.hub.app/cliente/${Math.random().toString(36).substring(7)}`;
      alert(`Link gerado! Envie para o cliente:\n\n${uniqueLink}\n\nO cliente vai preencher e a anamnese ir√° automaticamente para o hist√≥rico quando ele finalizar.`);
      onComplete(dadosCompletos as QuizData);
    } else {
      // Modo presencial: salvar direto
      onComplete(dadosCompletos as QuizData);
    }
  };

  const updateFormData = (data: Partial<QuizData>) => {
    setFormData({ ...formData, ...data });
  };

  // Definir √≠cone e cor por etapa
  const stepConfig = {
    1: { icon: FileText, color: 'text-blue-500', bg: 'bg-blue-50' },
    2: { icon: MapPin, color: 'text-green-500', bg: 'bg-green-50' },
    3: { icon: Heart, color: 'text-red-500', bg: 'bg-red-50' },
    4: { icon: AlertCircle, color: 'text-orange-500', bg: 'bg-orange-50' },
    5: { icon: Sparkles, color: 'text-purple-500', bg: 'bg-purple-50' },
    6: { icon: ImageIcon, color: 'text-indigo-500', bg: 'bg-indigo-50' },
    7: { icon: ImageIcon, color: coresTema.text500, bg: coresTema.bg50 },
    8: { icon: CheckCircle, color: 'text-emerald-500', bg: 'bg-emerald-50' },
  };

  const StepIcon = stepConfig[currentStep as keyof typeof stepConfig]?.icon || FileText;
  const iconColor = stepConfig[currentStep as keyof typeof stepConfig]?.color || 'text-blue-500';
  const iconBg = stepConfig[currentStep as keyof typeof stepConfig]?.bg || 'bg-blue-50';

  // Fun√ß√£o para renderizar uma pergunta personalizada
  const renderCustomQuestion = (question: any) => {
    const fieldKey = question.label.toLowerCase().replace(/\s+/g, '_');
    const hasError = fieldErrors[fieldKey];

    switch (question.type) {
      case 'text':
        return (
          <div key={question.id}>
            <input
              type="text"
              placeholder={question.label}
              className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                hasError ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
              }`}
              value={(formData as any)[fieldKey] || ''}
              onChange={(e) => updateFormData({ [fieldKey]: e.target.value })}
            />
            {hasError && (
              <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                ‚ö†Ô∏è {hasError}
              </p>
            )}
          </div>
        );

      case 'textarea':
        return (
          <div key={question.id}>
            <textarea
              placeholder={question.label}
              rows={4}
              className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors resize-none ${
                hasError ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
              }`}
              value={(formData as any)[fieldKey] || ''}
              onChange={(e) => updateFormData({ [fieldKey]: e.target.value })}
            />
            {hasError && (
              <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                ‚ö†Ô∏è {hasError}
              </p>
            )}
          </div>
        );

      case 'select':
        return (
          <div key={question.id}>
            <select
              className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                hasError ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
              }`}
              value={(formData as any)[fieldKey] || ''}
              onChange={(e) => updateFormData({ [fieldKey]: e.target.value })}
            >
              <option value="">{question.label}</option>
              {question.options?.map((opt: string) => (
                <option key={opt} value={opt}>{opt}</option>
              ))}
            </select>
            {hasError && (
              <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                ‚ö†Ô∏è {hasError}
              </p>
            )}
          </div>
        );

      case 'radio':
        return (
          <div key={question.id} className="space-y-2">
            <label className="block text-sm font-medium text-gray-700 mb-2">{question.label}</label>
            <div className="flex flex-wrap gap-3">
              {question.options?.map((opt: string) => (
                <label key={opt} className={`flex items-center gap-2 px-4 py-2 border-2 border-gray-200 rounded-xl cursor-pointer ${coresTema.hover} transition-colors`}>
                  <input
                    type="radio"
                    name={fieldKey}
                    value={opt}
                    checked={(formData as any)[fieldKey] === opt}
                    onChange={(e) => updateFormData({ [fieldKey]: e.target.value })}
                    className={coresTema.text500}
                  />
                  <span className="text-gray-900">{opt}</span>
                </label>
              ))}
            </div>
            {hasError && (
              <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                ‚ö†Ô∏è {hasError}
              </p>
            )}
          </div>
        );

      default:
        return null;
    }
  };

  // Renderizar Data da Anamnese (pen√∫ltimo step)
  const renderDataAnamnese = () => {
    return (
      <div className="space-y-5 animate-fadeIn">
        <div className="text-center mb-6">
          <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
            <StepIcon className={`h-8 w-8 ${iconColor}`} />
          </div>
          <h3 className="text-2xl font-bold text-gray-900">Data da Anamnese</h3>
          <p className="text-gray-600 mt-2">Confirme ou altere a data do preenchimento</p>
        </div>

        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              üìÖ Data da Anamnese <span className="text-red-500">*</span>
            </label>
            <input
              type="date"
              className={`w-full px-4 py-3 border-2 ${
                fieldErrors.dataAnamnese ? 'border-red-500' : 'border-gray-200'
              } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors text-lg`}
              value={formData.dataAnamnese || ''}
              onChange={(e) => updateFormData({ dataAnamnese: e.target.value })}
            />
            {fieldErrors.dataAnamnese && (
              <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                ‚ö†Ô∏è {fieldErrors.dataAnamnese}
              </p>
            )}
            <p className="text-xs text-gray-500 mt-2">
              üí° Esta √© a data em que a anamnese est√° sendo realizada
            </p>
          </div>

          {/* VALOR DA TATUAGEM/PROCEDIMENTO - Apenas para modo PRESENCIAL */}
          {mode === 'presencial' && (
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                üí∞ Valor do Procedimento
              </label>
              <div className="relative">
                <span className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">R$</span>
                <input
                  type="text"
                  inputMode="numeric"
                  placeholder="0,00"
                  className={`w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors text-lg font-semibold`}
                  value={valorFormatado}
                  onChange={(e) => handleValorChange(e.target.value)}
                />
              </div>
              <p className="text-xs text-gray-500 mt-1">
                Digite apenas n√∫meros ‚Ä¢ O valor ser√° formatado automaticamente
              </p>
            </div>
          )}
        </div>
      </div>
    );
  };

  // Renderizar Termo de Compromisso (√∫ltimo step) - Diferente para cada modo
  const renderTermoDeCompromisso = () => {
    return (
      <div className="space-y-5 animate-fadeIn">
        <div className="text-center mb-6">
          <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
            <StepIcon className={`h-8 w-8 ${iconColor}`} />
          </div>
          <h3 className="text-2xl font-bold text-gray-900">Termo de Compromisso</h3>
          <p className="text-gray-600 mt-2">√öltima etapa! Assine digitalmente</p>
        </div>
        <div className="space-y-4">
          <div className="bg-gray-50 p-4 rounded-xl border-2 border-gray-200 max-h-[200px] overflow-y-auto">
            <p className="text-sm text-gray-700 leading-relaxed">
              Eu, <strong>{formData.nomeCompleto || '[Nome]'}</strong>, declaro que as informa√ß√µes fornecidas s√£o verdadeiras.
              Estou ciente dos riscos do procedimento de tatuagem e concordo em seguir todas as orienta√ß√µes
              de cuidados p√≥s-procedimento. Confirmo que n√£o possuo contraindica√ß√µes m√©dicas para realizar
              este procedimento.
            </p>
          </div>

          <div className={`flex items-center gap-3 p-4 ${coresTema.bg50} rounded-xl border-2 ${coresTema.border200}`}>
            <input
              type="checkbox"
              id="termo"
              checked={formData.aceitaTermo || false}
              onChange={(e) => updateFormData({ aceitaTermo: e.target.checked })}
              className={`w-5 h-5 ${coresTema.text500} rounded`}
            />
            <label htmlFor="termo" className="text-sm font-medium text-gray-900 cursor-pointer">
              Li e concordo com o termo de compromisso
            </label>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Assinatura Digital
            </label>
            <input
              type="text"
              placeholder="Digite seu nome completo como assinatura"
              className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors font-signature text-xl`}
              value={formData.assinatura || ''}
              onChange={(e) => updateFormData({ assinatura: e.target.value })}
              style={{ fontFamily: 'cursive' }}
            />
          </div>
        </div>
      </div>
    );
  };

  // Renderizar step customizado
  const renderCustomStep = () => {
    const currentSection = sections[currentStep - 1];
    const questions = groupedQuestions[currentSection];

    // PROTE√á√ÉO: Se n√£o tem perguntas, n√£o renderiza (evita erro)
    if (!questions || questions.length === 0) {
      console.warn('‚ö†Ô∏è Nenhuma pergunta encontrada para a se√ß√£o:', currentSection);
      return null;
    }

    return (
      <div className="space-y-5 animate-fadeIn">
        <div className="text-center mb-6">
          <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
            <StepIcon className={`h-8 w-8 ${iconColor}`} />
          </div>
          <h3 className="text-2xl font-bold text-gray-900">{currentSection}</h3>
          <p className="text-gray-600 mt-2">Preencha as informa√ß√µes abaixo</p>
        </div>
        <div className="space-y-4">
          {questions.map((q: any) => renderCustomQuestion(q))}
        </div>
      </div>
    );
  };

  // ü•ó RENDERIZAR STEPS DE NUTRI√á√ÉO (Steps 2-6)
  const renderStepNutricao = () => {
    const profissao = localStorage.getItem('anamneseConfig') ? JSON.parse(localStorage.getItem('anamneseConfig')!).templateProfissao : 'tatuagem';
    const iconBg = coresTema.bg50;
    const iconColor = coresTema.text500;
    const StepIcon = FileText;

    switch (currentStep) {
      case 2:
        // Step 2: Objetivo e Dados Corporais
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <StepIcon className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Objetivo e Dados Corporais</h3>
              <p className="text-gray-600 mt-2">Qual seu objetivo com o acompanhamento nutricional?</p>
            </div>
            <div className="space-y-4">
              {/* Objetivo Nutricional */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Qual √© o seu objetivo principal? <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.objetivoNutricional || ''}
                  onChange={(e) => updateFormData({ objetivoNutricional: e.target.value })}
                >
                  <option value="">Selecione seu objetivo *</option>
                  <option value="Emagrecimento">Emagrecimento / Perda de peso</option>
                  <option value="Ganho de massa muscular">Ganho de massa muscular</option>
                  <option value="Melhora da sa√∫de geral">Melhora da sa√∫de geral</option>
                  <option value="Performance esportiva">Performance esportiva</option>
                  <option value="Controle de doen√ßa">Controle de doen√ßa (diabetes, hipertens√£o, etc)</option>
                  <option value="Outro">Outro</option>
                </select>
              </div>

              {/* Peso e Altura com c√°lculo de IMC */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Peso atual (kg) <span className="text-red-500">*</span>
                  </label>
                  <input
                    type="number"
                    step="0.1"
                    placeholder="Ex: 75.5 *"
                    className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                    value={formData.pesoAtual || ''}
                    onChange={(e) => {
                      const peso = e.target.value;
                      const altura = formData.altura;
                      let imc = '';
                      if (peso && altura) {
                        const alturaMetros = parseFloat(altura) / 100;
                        const imcCalc = parseFloat(peso) / (alturaMetros * alturaMetros);
                        imc = imcCalc.toFixed(1);
                      }
                      updateFormData({ pesoAtual: peso, imc });
                    }}
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Altura (cm) <span className="text-red-500">*</span>
                  </label>
                  <input
                    type="number"
                    placeholder="Ex: 170 *"
                    className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                    value={formData.altura || ''}
                    onChange={(e) => {
                      const altura = e.target.value;
                      const peso = formData.pesoAtual;
                      let imc = '';
                      if (peso && altura) {
                        const alturaMetros = parseFloat(altura) / 100;
                        const imcCalc = parseFloat(peso) / (alturaMetros * alturaMetros);
                        imc = imcCalc.toFixed(1);
                      }
                      updateFormData({ altura, imc });
                    }}
                  />
                </div>
              </div>

              {/* IMC Calculado */}
              {formData.imc && (
                <div className={`p-4 ${coresTema.bg50} rounded-xl border-2 ${coresTema.border200}`}>
                  <p className="text-sm font-medium text-gray-700">
                    IMC Calculado: <span className={`text-lg font-bold ${coresTema.text500}`}>{formData.imc}</span>
                  </p>
                  <p className="text-xs text-gray-500 mt-1">
                    {parseFloat(formData.imc) < 18.5 && 'Abaixo do peso'}
                    {parseFloat(formData.imc) >= 18.5 && parseFloat(formData.imc) < 25 && 'Peso normal'}
                    {parseFloat(formData.imc) >= 25 && parseFloat(formData.imc) < 30 && 'Sobrepeso'}
                    {parseFloat(formData.imc) >= 30 && 'Obesidade'}
                  </p>
                </div>
              )}

              {/* Hist√≥rico de Emagrecimento */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  J√° tentou emagrecer ou mudar seus h√°bitos alimentares antes?
                </label>
                <textarea
                  rows={3}
                  placeholder="Descreva suas tentativas anteriores, o que funcionou ou n√£o..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.historicoEmagrecimento || ''}
                  onChange={(e) => updateFormData({ historicoEmagrecimento: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 3:
        // Step 3: H√°bitos Alimentares
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Heart className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">H√°bitos Alimentares</h3>
              <p className="text-gray-600 mt-2">Como √© sua rotina alimentar?</p>
            </div>
            <div className="space-y-4">
              {/* Quantas Refei√ß√µes */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Quantas refei√ß√µes voc√™ faz por dia?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.quantasRefeicoes || ''}
                  onChange={(e) => updateFormData({ quantasRefeicoes: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="1-2">1 a 2 refei√ß√µes</option>
                  <option value="3">3 refei√ß√µes</option>
                  <option value="4">4 refei√ß√µes</option>
                  <option value="5">5 refei√ß√µes</option>
                  <option value="6+">6 ou mais refei√ß√µes</option>
                </select>
              </div>

              {/* Alimentos que Gosta */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Quais alimentos voc√™ mais gosta de comer?
                </label>
                <textarea
                  rows={3}
                  placeholder="Liste os alimentos que voc√™ gosta e come com frequ√™ncia..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.alimentosGosta || ''}
                  onChange={(e) => updateFormData({ alimentosGosta: e.target.value })}
                />
              </div>

              {/* Alimentos que Evita */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Tem algum alimento que voc√™ n√£o gosta ou evita?
                </label>
                <textarea
                  rows={3}
                  placeholder="Liste alimentos que voc√™ n√£o gosta..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.alimentosEvita || ''}
                  onChange={(e) => updateFormData({ alimentosEvita: e.target.value })}
                />
              </div>

              {/* Restri√ß√£o Alimentar */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Segue alguma dieta ou restri√ß√£o alimentar?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.restricaoAlimentar || ''}
                  onChange={(e) => updateFormData({ restricaoAlimentar: e.target.value })}
                >
                  <option value="">Nenhuma restri√ß√£o</option>
                  <option value="Vegetariano">Vegetariano</option>
                  <option value="Vegano">Vegano</option>
                  <option value="Ovolactovegetariano">Ovolactovegetariano</option>
                  <option value="Low carb">Low carb</option>
                  <option value="Sem gl√∫ten">Sem gl√∫ten</option>
                  <option value="Sem lactose">Sem lactose</option>
                  <option value="Outra">Outra</option>
                </select>
              </div>

              {/* Intoler√¢ncia/Alergia */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Tem alguma intoler√¢ncia ou alergia alimentar?
                </label>
                <textarea
                  rows={2}
                  placeholder="Ex: Lactose, gl√∫ten, frutos do mar, amendoim..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.intoleranciaAlergia || ''}
                  onChange={(e) => updateFormData({ intoleranciaAlergia: e.target.value })}
                />
              </div>

              {/* Consumo de √Ågua */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Quantos litros de √°gua voc√™ bebe por dia?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.litrosAgua || ''}
                  onChange={(e) => updateFormData({ litrosAgua: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="Menos de 1L">Menos de 1 litro</option>
                  <option value="1 a 1.5L">1 a 1,5 litros</option>
                  <option value="1.5 a 2L">1,5 a 2 litros</option>
                  <option value="2 a 3L">2 a 3 litros</option>
                  <option value="Mais de 3L">Mais de 3 litros</option>
                </select>
              </div>
            </div>
          </div>
        );

      case 4:
        // Step 4: Estilo de Vida
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Sparkles className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Estilo de Vida</h3>
              <p className="text-gray-600 mt-2">Atividade f√≠sica e rotina</p>
            </div>
            <div className="space-y-4">
              {/* Atividade F√≠sica */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Qual √© o seu n√≠vel de atividade f√≠sica?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.atividadeFisica || ''}
                  onChange={(e) => updateFormData({ atividadeFisica: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="Sedent√°rio">Sedent√°rio (n√£o pratico exerc√≠cios)</option>
                  <option value="Leve">Leve (1-2x por semana)</option>
                  <option value="Moderado">Moderado (3-4x por semana)</option>
                  <option value="Intenso">Intenso (5-6x por semana)</option>
                  <option value="Muito intenso">Muito intenso (treino di√°rio)</option>
                </select>
              </div>

              {/* Qualidade do Sono */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Como voc√™ avalia sua qualidade de sono?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.qualidadeSono || ''}
                  onChange={(e) => updateFormData({ qualidadeSono: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="Excelente">Excelente - Durmo muito bem</option>
                  <option value="Boa">Boa - Durmo bem na maioria das noites</option>
                  <option value="Regular">Regular - Acordo cansado √†s vezes</option>
                  <option value="Ruim">Ruim - Tenho dificuldade para dormir</option>
                  <option value="P√©ssima">P√©ssima - Sofro com ins√¥nia</option>
                </select>
              </div>

              {/* Horas de Sono */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Quantas horas voc√™ dorme por noite?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.horasSono || ''}
                  onChange={(e) => updateFormData({ horasSono: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="Menos de 4h">Menos de 4 horas</option>
                  <option value="4-5h">4 a 5 horas</option>
                  <option value="5-6h">5 a 6 horas</option>
                  <option value="6-7h">6 a 7 horas</option>
                  <option value="7-8h">7 a 8 horas</option>
                  <option value="Mais de 8h">Mais de 8 horas</option>
                </select>
              </div>

              {/* Funcionamento Intestinal */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Como √© sua regularidade intestinal?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.funcionamentoIntestinal || ''}
                  onChange={(e) => updateFormData({ funcionamentoIntestinal: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="Regular - 1x por dia">Regular - 1 vez por dia</option>
                  <option value="Regular - 2-3x por dia">Regular - 2 a 3 vezes por dia</option>
                  <option value="Irregular - Dia sim dia n√£o">Irregular - Dia sim, dia n√£o</option>
                  <option value="Constipa√ß√£o - Menos de 3x por semana">Constipa√ß√£o - Menos de 3x por semana</option>
                  <option value="Diarreia frequente">Diarreia frequente</option>
                </select>
              </div>

              {/* Consumo de √Ålcool */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Com que frequ√™ncia voc√™ consome bebidas alco√≥licas?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.consumoAlcool || ''}
                  onChange={(e) => updateFormData({ consumoAlcool: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="N√£o bebo">N√£o bebo</option>
                  <option value="Raramente">Raramente (1-2x por m√™s)</option>
                  <option value="Socialmente">Socialmente (1-2x por semana)</option>
                  <option value="Frequentemente">Frequentemente (3-4x por semana)</option>
                  <option value="Diariamente">Diariamente</option>
                </select>
              </div>
            </div>
          </div>
        );

      case 5:
        // Step 5: Sa√∫de e Hist√≥rico M√©dico
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <AlertCircle className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Hist√≥rico de Sa√∫de</h3>
              <p className="text-gray-600 mt-2">Doen√ßas, medicamentos e exames</p>
            </div>
            <div className="space-y-4">
              {/* Doen√ßas/Condi√ß√µes */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Tem alguma doen√ßa ou condi√ß√£o de sa√∫de?
                </label>
                <textarea
                  rows={3}
                  placeholder="Ex: Diabetes, hipertens√£o, colesterol alto, hipotireoidismo, SOP..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.doencasCondicoes || ''}
                  onChange={(e) => updateFormData({ doencasCondicoes: e.target.value })}
                />
              </div>

              {/* Uso de Suplementos */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Faz uso de suplementos ou vitaminas?
                </label>
                <textarea
                  rows={3}
                  placeholder="Whey protein, creatina, multivitam√≠nico, √¥mega 3, vitamina D..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.usoSuplementos || ''}
                  onChange={(e) => updateFormData({ usoSuplementos: e.target.value })}
                />
              </div>

              {/* Exames Recentes */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Realizou exames recentemente? Quais?
                </label>
                <textarea
                  rows={3}
                  placeholder="Hemograma, glicemia, colesterol, triglicer√≠deos, TSH, etc..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.examesRecentes || ''}
                  onChange={(e) => updateFormData({ examesRecentes: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 6:
        // Step 6: Expectativas
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <CheckCircle className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Expectativas e Objetivos</h3>
              <p className="text-gray-600 mt-2">O que voc√™ espera alcan√ßar?</p>
            </div>
            <div className="space-y-4">
              {/* Expectativas */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Descreva suas expectativas e objetivos com a nutricionista
                </label>
                <textarea
                  rows={5}
                  placeholder="O que voc√™ espera alcan√ßar? H√° quanto tempo busca esses objetivos? Tem alguma data ou meta espec√≠fica?"
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.expectativasNutricao || ''}
                  onChange={(e) => updateFormData({ expectativasNutricao: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  // ========== QUIZ DE PSICOLOGIA (Steps 2-6) ==========
  const renderStepPsicologia = () => {
    const iconBg = coresTema.bg50;
    const iconColor = coresTema.text500;

    switch (currentStep) {
      case 2:
        // Step 2: Motivo da Busca e Queixa Principal
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Heart className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Motivo da Busca</h3>
              <p className="text-gray-600 mt-2">Por que voc√™ est√° buscando terapia?</p>
            </div>
            <div className="space-y-4">
              {/* Faixa Et√°ria */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Faixa Et√°ria <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.faixaEtaria || ''}
                  onChange={(e) => updateFormData({ faixaEtaria: e.target.value })}
                >
                  <option value="">Selecione sua faixa et√°ria *</option>
                  <option value="18-25">18-25 anos</option>
                  <option value="26-35">26-35 anos</option>
                  <option value="36-45">36-45 anos</option>
                  <option value="46-55">46-55 anos</option>
                  <option value="56-65">56-65 anos</option>
                  <option value="66+">66+ anos</option>
                </select>
              </div>

              {/* Motivo da Busca */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  O que te motivou a buscar terapia? <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.motivoBusca || ''}
                  onChange={(e) => updateFormData({ motivoBusca: e.target.value })}
                >
                  <option value="">Selecione o motivo *</option>
                  <option value="Ansiedade">Ansiedade</option>
                  <option value="Depress√£o">Depress√£o</option>
                  <option value="Estresse">Estresse</option>
                  <option value="Relacionamentos">Problemas de relacionamento</option>
                  <option value="Autoconhecimento">Autoconhecimento</option>
                  <option value="Luto">Luto / Perda</option>
                  <option value="Trauma">Trauma</option>
                  <option value="Outro">Outro</option>
                </select>
              </div>

              {/* Queixa Principal */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Descreva sua queixa principal <span className="text-red-500">*</span>
                </label>
                <textarea
                  rows={4}
                  placeholder="Conte um pouco sobre o que voc√™ est√° sentindo ou vivenciando... *"
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.queixaPrincipal || ''}
                  onChange={(e) => updateFormData({ queixaPrincipal: e.target.value })}
                />
              </div>

              {/* Sintomas */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Quais sintomas voc√™ tem sentido?
                </label>
                <textarea
                  rows={3}
                  placeholder="Ex: ins√¥nia, falta de apetite, dificuldade de concentra√ß√£o, tristeza..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.sintomas || ''}
                  onChange={(e) => updateFormData({ sintomas: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 3:
        // Step 3: Hist√≥rico de Tratamento
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <FileText className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Hist√≥rico de Tratamento</h3>
              <p className="text-gray-600 mt-2">Informa√ß√µes sobre tratamentos anteriores</p>
            </div>
            <div className="space-y-4">
              {/* Hist√≥rico de Tratamento */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  J√° fez terapia ou tratamento psicol√≥gico antes?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.historicoTratamento || ''}
                  onChange={(e) => updateFormData({ historicoTratamento: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="Nunca fiz">Nunca fiz terapia</option>
                  <option value="Sim, no passado">Sim, no passado</option>
                  <option value="Sim, atualmente">Sim, estou em tratamento atualmente</option>
                </select>
              </div>

              {/* Medicamentos Psiqui√°tricos */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Faz uso de medicamentos psiqui√°tricos?
                </label>
                <textarea
                  rows={3}
                  placeholder="Se sim, quais medicamentos e dosagens..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.medicamentosUso || ''}
                  onChange={(e) => updateFormData({ medicamentosUso: e.target.value })}
                />
              </div>

              {/* Hist√≥ria Familiar */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Hist√≥rico familiar de problemas de sa√∫de mental
                </label>
                <textarea
                  rows={3}
                  placeholder="Ex: depress√£o, ansiedade, transtorno bipolar na fam√≠lia..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.historiaFamiliar || ''}
                  onChange={(e) => updateFormData({ historiaFamiliar: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 4:
        // Step 4: Eventos Significativos e Apoio Social
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Heart className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Hist√≥ria de Vida</h3>
              <p className="text-gray-600 mt-2">Eventos importantes e rede de apoio</p>
            </div>
            <div className="space-y-4">
              {/* Eventos Significativos */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Eventos significativos na sua vida
                </label>
                <textarea
                  rows={4}
                  placeholder="Situa√ß√µes ou momentos marcantes que voc√™ considera importantes na sua trajet√≥ria..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.eventosSignificativos || ''}
                  onChange={(e) => updateFormData({ eventosSignificativos: e.target.value })}
                />
              </div>

              {/* Apoio Social */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Rede de apoio (fam√≠lia, amigos, parceiro)
                </label>
                <textarea
                  rows={3}
                  placeholder="Como √© sua rede de apoio? Com quem voc√™ pode contar?"
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.apoioSocial || ''}
                  onChange={(e) => updateFormData({ apoioSocial: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 5:
        // Step 5: Objetivos e Expectativas
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Sparkles className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Objetivos da Terapia</h3>
              <p className="text-gray-600 mt-2">O que voc√™ espera alcan√ßar?</p>
            </div>
            <div className="space-y-4">
              {/* Objetivos */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  O que voc√™ espera alcan√ßar com a terapia? <span className="text-red-500">*</span>
                </label>
                <textarea
                  rows={4}
                  placeholder="Seus objetivos e metas para o processo terap√™utico... *"
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.objetivosTerapia || ''}
                  onChange={(e) => updateFormData({ objetivosTerapia: e.target.value })}
                />
              </div>

              {/* Expectativas */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Expectativas gerais sobre o processo terap√™utico
                </label>
                <textarea
                  rows={3}
                  placeholder="O que voc√™ espera do terapeuta e do processo?"
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.expectativasPsicologia || ''}
                  onChange={(e) => updateFormData({ expectativasPsicologia: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  // üí™ RENDERIZAR STEPS DE FISIOTERAPIA (Steps 2-6)
  const renderStepFisioterapia = () => {
    switch (currentStep) {
      case 2:
        // Step 2: Motivo da Consulta
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Heart className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Motivo da Consulta</h3>
              <p className="text-gray-600 mt-2">Conte-nos sobre o que trouxe voc√™ aqui</p>
            </div>
            <div className="space-y-4">
              {/* Motivo Principal */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Qual o motivo principal da consulta? <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.motivoConsultaFisio ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.motivoConsultaFisio || ''}
                  onChange={(e) => updateFormData({ motivoConsultaFisio: e.target.value })}
                >
                  <option value="">Selecione o motivo *</option>
                  <option value="Dor">Dor</option>
                  <option value="Les√£o">Les√£o</option>
                  <option value="Reabilita√ß√£o p√≥s-cir√∫rgica">Reabilita√ß√£o p√≥s-cir√∫rgica</option>
                  <option value="Preven√ß√£o">Preven√ß√£o</option>
                  <option value="Melhora de desempenho">Melhora de desempenho</option>
                  <option value="Outro">Outro</option>
                </select>
                {fieldErrors.motivoConsultaFisio && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.motivoConsultaFisio}
                  </p>
                )}
              </div>

              {/* Quando Come√ßou */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Quando come√ßou o problema? <span className="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  placeholder="Ex: H√° 2 semanas, h√° 3 meses, desde crian√ßa... *"
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.quandoComecou ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.quandoComecou || ''}
                  onChange={(e) => updateFormData({ quandoComecou: e.target.value })}
                />
                {fieldErrors.quandoComecou && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.quandoComecou}
                  </p>
                )}
              </div>

              {/* O que estava fazendo */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  O que voc√™ estava fazendo quando come√ßou?
                </label>
                <textarea
                  rows={3}
                  placeholder="Descreva a situa√ß√£o em que o problema come√ßou..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.oQueEstavaFazendo || ''}
                  onChange={(e) => updateFormData({ oQueEstavaFazendo: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 3:
        // Step 3: Dor e Sintomas
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <AlertCircle className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Dor e Sintomas</h3>
              <p className="text-gray-600 mt-2">Descreva sua dor e desconfortos</p>
            </div>
            <div className="space-y-4">
              {/* Localiza√ß√£o da Dor */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Localiza√ß√£o da dor/desconforto <span className="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  placeholder="Ex: Coluna lombar, joelho direito, ombro esquerdo... *"
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.localizacaoDor ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.localizacaoDor || ''}
                  onChange={(e) => updateFormData({ localizacaoDor: e.target.value })}
                />
                {fieldErrors.localizacaoDor && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.localizacaoDor}
                  </p>
                )}
              </div>

              {/* Intensidade da Dor */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Intensidade da dor (0 = sem dor, 10 = pior dor imagin√°vel) <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.intensidadeDor ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.intensidadeDor || ''}
                  onChange={(e) => updateFormData({ intensidadeDor: e.target.value })}
                >
                  <option value="">Selecione a intensidade *</option>
                  {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(num => (
                    <option key={num} value={num.toString()}>{num} {num === 0 ? '- Sem dor' : num === 10 ? '- Pior dor' : ''}</option>
                  ))}
                </select>
                {fieldErrors.intensidadeDor && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.intensidadeDor}
                  </p>
                )}
              </div>

              {/* Tipo de Dor */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Tipo de dor
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.tipoDor || ''}
                  onChange={(e) => updateFormData({ tipoDor: e.target.value })}
                >
                  <option value="">Selecione o tipo de dor</option>
                  <option value="Aguda">Aguda</option>
                  <option value="Cr√¥nica">Cr√¥nica</option>
                  <option value="Latejante">Latejante</option>
                  <option value="Queima√ß√£o">Queima√ß√£o</option>
                  <option value="Formigamento">Formigamento</option>
                  <option value="Pontada">Pontada</option>
                  <option value="Outro">Outro</option>
                </select>
              </div>

              {/* O que piora */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  O que piora a dor?
                </label>
                <textarea
                  rows={2}
                  placeholder="Ex: Ficar sentado muito tempo, subir escadas, movimentos bruscos..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.oQuePioraDor || ''}
                  onChange={(e) => updateFormData({ oQuePioraDor: e.target.value })}
                />
              </div>

              {/* O que melhora */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  O que melhora a dor?
                </label>
                <textarea
                  rows={2}
                  placeholder="Ex: Repouso, aplica√ß√£o de gelo, alongamentos, medica√ß√£o..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.oQueMelhoraDor || ''}
                  onChange={(e) => updateFormData({ oQueMelhoraDor: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 4:
        // Step 4: Hist√≥rico M√©dico
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <FileText className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Hist√≥rico M√©dico</h3>
              <p className="text-gray-600 mt-2">Informa√ß√µes sobre tratamentos anteriores</p>
            </div>
            <div className="space-y-4">
              {/* J√° fez fisioterapia antes */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  J√° fez fisioterapia antes?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.jafezFisioterapia || ''}
                  onChange={(e) => updateFormData({ jafezFisioterapia: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="N√£o">N√£o</option>
                  <option value="Sim, foi eficaz">Sim, foi eficaz</option>
                  <option value="Sim, n√£o foi eficaz">Sim, n√£o foi eficaz</option>
                </select>
              </div>

              {/* Hist√≥rico de Cirurgias */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Hist√≥rico de cirurgias ortop√©dicas
                </label>
                <textarea
                  rows={3}
                  placeholder="Liste cirurgias anteriores, quando foram realizadas e qual a regi√£o..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.historicoCirurgias || ''}
                  onChange={(e) => updateFormData({ historicoCirurgias: e.target.value })}
                />
              </div>

              {/* Medicamentos para Dor */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Usa medicamentos para dor?
                </label>
                <textarea
                  rows={2}
                  placeholder="Liste os medicamentos, frequ√™ncia e dosagem..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.medicamentosDor || ''}
                  onChange={(e) => updateFormData({ medicamentosDor: e.target.value })}
                />
              </div>

              {/* Doen√ßas Cr√¥nicas */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Possui doen√ßas cr√¥nicas? (Diabetes, Hipertens√£o, etc.)
                </label>
                <textarea
                  rows={2}
                  placeholder="Liste suas condi√ß√µes de sa√∫de..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.doencasCronicas || ''}
                  onChange={(e) => updateFormData({ doencasCronicas: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 5:
        // Step 5: Atividades e Mobilidade
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Sparkles className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Atividades e Mobilidade</h3>
              <p className="text-gray-600 mt-2">Sua rotina e limita√ß√µes</p>
            </div>
            <div className="space-y-4">
              {/* Atividade F√≠sica */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Pratica atividades f√≠sicas?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.atividadeFisicaFisio || ''}
                  onChange={(e) => updateFormData({ atividadeFisicaFisio: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="Sedent√°rio">Sedent√°rio</option>
                  <option value="1-2x por semana">1-2x por semana</option>
                  <option value="3-4x por semana">3-4x por semana</option>
                  <option value="5-7x por semana">5-7x por semana</option>
                  <option value="Atleta">Atleta</option>
                </select>
              </div>

              {/* Limita√ß√µes de Movimento */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Quais limita√ß√µes de movimento voc√™ apresenta?
                </label>
                <textarea
                  rows={3}
                  placeholder="Ex: Dificuldade para se abaixar, levantar peso, caminhar longas dist√¢ncias..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.limitacoesMovimento || ''}
                  onChange={(e) => updateFormData({ limitacoesMovimento: e.target.value })}
                />
              </div>

              {/* Uso de √ìrteses */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Usa √≥rteses, pr√≥teses ou auxiliares de marcha?
                </label>
                <textarea
                  rows={2}
                  placeholder="Ex: Bengala, muletas, joelheira, palmilha ortop√©dica..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.usoOrteses || ''}
                  onChange={(e) => updateFormData({ usoOrteses: e.target.value })}
                />
              </div>

              {/* Profiss√£o e Atividades */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Profiss√£o e atividades di√°rias
                </label>
                <textarea
                  rows={3}
                  placeholder="Descreva sua profiss√£o e principais atividades do dia a dia..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.profissaoAtividades || ''}
                  onChange={(e) => updateFormData({ profissaoAtividades: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 6:
        // Step 6: Objetivos
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <CheckCircle className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Objetivos</h3>
              <p className="text-gray-600 mt-2">O que voc√™ espera alcan√ßar?</p>
            </div>
            <div className="space-y-4">
              {/* Objetivos */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  O que voc√™ espera alcan√ßar com a fisioterapia? <span className="text-red-500">*</span>
                </label>
                <textarea
                  rows={5}
                  placeholder="Descreva seus objetivos e expectativas... *"
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.objetivosFisioterapia ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.objetivosFisioterapia || ''}
                  onChange={(e) => updateFormData({ objetivosFisioterapia: e.target.value })}
                />
                {fieldErrors.objetivosFisioterapia && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.objetivosFisioterapia}
                  </p>
                )}
              </div>
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  // ========== EST√âTICA: Steps 2-6 ==========
  const renderStepEstetica = () => {
    const iconBg = coresTema.bg50;
    const iconColor = coresTema.text500;

    switch (currentStep) {
      case 2:
        // Step 2: Procedimento e Tipo de Pele
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Sparkles className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Procedimento e Tipo de Pele</h3>
              <p className="text-gray-600 mt-2">Vamos entender suas necessidades</p>
            </div>
            <div className="space-y-4">
              {/* Procedimento Desejado */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Qual procedimento deseja realizar? <span className="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  placeholder="Ex: Limpeza de pele, Peeling, Botox, Preenchimento... *"
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.procedimentoDesejado ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.procedimentoDesejado || ''}
                  onChange={(e) => updateFormData({ procedimentoDesejado: e.target.value })}
                />
                {fieldErrors.procedimentoDesejado && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.procedimentoDesejado}
                  </p>
                )}
              </div>

              {/* Tipo de Pele */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Tipo de pele <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.tipoPele ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.tipoPele || ''}
                  onChange={(e) => updateFormData({ tipoPele: e.target.value })}
                >
                  <option value="">Selecione o tipo de pele *</option>
                  <option value="Oleosa">Oleosa</option>
                  <option value="Seca">Seca</option>
                  <option value="Mista">Mista</option>
                  <option value="Sens√≠vel">Sens√≠vel</option>
                  <option value="Normal">Normal</option>
                </select>
                {fieldErrors.tipoPele && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.tipoPele}
                  </p>
                )}
              </div>

              {/* Principais problemas de pele */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Principais problemas de pele
                </label>
                <textarea
                  rows={3}
                  placeholder="Ex: Acne, manchas, rugas, linhas de express√£o, flacidez..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.problemaPele || ''}
                  onChange={(e) => updateFormData({ problemaPele: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 3:
        // Step 3: Cuidados e Exposi√ß√£o Solar
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Heart className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Cuidados e Exposi√ß√£o Solar</h3>
              <p className="text-gray-600 mt-2">Rotina de cuidados com a pele</p>
            </div>
            <div className="space-y-4">
              {/* Exposi√ß√£o ao sol */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Exposi√ß√£o ao sol <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.exposicaoSol ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.exposicaoSol || ''}
                  onChange={(e) => updateFormData({ exposicaoSol: e.target.value })}
                >
                  <option value="">Selecione *</option>
                  <option value="Frequente">Frequente (todos os dias)</option>
                  <option value="Moderada">Moderada (algumas vezes por semana)</option>
                  <option value="Raramente">Raramente</option>
                  <option value="Nunca">Nunca</option>
                </select>
                {fieldErrors.exposicaoSol && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.exposicaoSol}
                  </p>
                )}
              </div>

              {/* Usa protetor solar */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Usa protetor solar diariamente? <span className="text-red-500">*</span>
                </label>
                <div className="flex gap-4">
                  <button
                    type="button"
                    onClick={() => updateFormData({ usaProtetorSolar: 'Sim' })}
                    className={`flex-1 px-4 py-3 border-2 rounded-xl font-medium transition-all ${
                      formData.usaProtetorSolar === 'Sim'
                        ? `${coresTema.border500} ${coresTema.bg50} ${coresTema.text500}`
                        : 'border-gray-200 text-gray-700 hover:border-gray-300'
                    }`}
                  >
                    ‚úì Sim
                  </button>
                  <button
                    type="button"
                    onClick={() => updateFormData({ usaProtetorSolar: 'N√£o' })}
                    className={`flex-1 px-4 py-3 border-2 rounded-xl font-medium transition-all ${
                      formData.usaProtetorSolar === 'N√£o'
                        ? `${coresTema.border500} ${coresTema.bg50} ${coresTema.text500}`
                        : 'border-gray-200 text-gray-700 hover:border-gray-300'
                    }`}
                  >
                    ‚úï N√£o
                  </button>
                </div>
                {fieldErrors.usaProtetorSolar && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.usaProtetorSolar}
                  </p>
                )}
              </div>

              {/* Rotina de cuidados */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Rotina de cuidados com a pele
                </label>
                <textarea
                  rows={3}
                  placeholder="Ex: Limpeza, hidrata√ß√£o, produtos que usa..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.cuidadosPele || ''}
                  onChange={(e) => updateFormData({ cuidadosPele: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 4:
        // Step 4: Alergias e Hist√≥rico
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <AlertCircle className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Alergias e Hist√≥rico</h3>
              <p className="text-gray-600 mt-2">Informa√ß√µes importantes para sua seguran√ßa</p>
            </div>
            <div className="space-y-4">
              {/* Alergias a cosm√©ticos */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Alergias a cosm√©ticos ou produtos?
                </label>
                <textarea
                  rows={2}
                  placeholder="Ex: Parabenos, fragr√¢ncias, √°cidos espec√≠ficos..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.alergiasCosmeticos || ''}
                  onChange={(e) => updateFormData({ alergiasCosmeticos: e.target.value })}
                />
              </div>

              {/* Hist√≥rico de cirurgias est√©ticas */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Hist√≥rico de cirurgias est√©ticas
                </label>
                <textarea
                  rows={2}
                  placeholder="Ex: Rinoplastia, lipoaspira√ß√£o, blefaroplastia..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.cirurgiasEsteticas || ''}
                  onChange={(e) => updateFormData({ cirurgiasEsteticas: e.target.value })}
                />
              </div>

              {/* Procedimentos anteriores */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Procedimentos est√©ticos anteriores
                </label>
                <textarea
                  rows={2}
                  placeholder="Ex: Botox, preenchimento, laser, peeling..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.procedimentosAnteriores || ''}
                  onChange={(e) => updateFormData({ procedimentosAnteriores: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 5:
        // Step 5: Medicamentos e Cicatriza√ß√£o
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <FileText className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Medicamentos e Cicatriza√ß√£o</h3>
              <p className="text-gray-600 mt-2">Informa√ß√µes sobre medicamentos e cicatriza√ß√£o</p>
            </div>
            <div className="space-y-4">
              {/* Medicamentos para pele */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Usa algum medicamento para a pele?
                </label>
                <textarea
                  rows={2}
                  placeholder="Ex: Isotretino√≠na (Roacutan), √°cidos, antibi√≥ticos..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.usaMedicamentoPele || ''}
                  onChange={(e) => updateFormData({ usaMedicamentoPele: e.target.value })}
                />
              </div>

              {/* Cicatriza√ß√£o */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Como √© sua cicatriza√ß√£o? <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.cicatrizacao ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.cicatrizacao || ''}
                  onChange={(e) => updateFormData({ cicatrizacao: e.target.value })}
                >
                  <option value="">Selecione *</option>
                  <option value="Normal">Normal</option>
                  <option value="Lenta">Lenta</option>
                  <option value="R√°pida">R√°pida</option>
                  <option value="Tend√™ncia a queloides">Tend√™ncia a queloides</option>
                </select>
                {fieldErrors.cicatrizacao && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.cicatrizacao}
                  </p>
                )}
              </div>

              {/* Gestante ou amamentando */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Est√° gestante ou amamentando? <span className="text-red-500">*</span>
                </label>
                <div className="flex gap-4">
                  <button
                    type="button"
                    onClick={() => updateFormData({ gestanteAmamentando: 'Sim' })}
                    className={`flex-1 px-4 py-3 border-2 rounded-xl font-medium transition-all ${
                      formData.gestanteAmamentando === 'Sim'
                        ? `${coresTema.border500} ${coresTema.bg50} ${coresTema.text500}`
                        : 'border-gray-200 text-gray-700 hover:border-gray-300'
                    }`}
                  >
                    Sim
                  </button>
                  <button
                    type="button"
                    onClick={() => updateFormData({ gestanteAmamentando: 'N√£o' })}
                    className={`flex-1 px-4 py-3 border-2 rounded-xl font-medium transition-all ${
                      formData.gestanteAmamentando === 'N√£o'
                        ? `${coresTema.border500} ${coresTema.bg50} ${coresTema.text500}`
                        : 'border-gray-200 text-gray-700 hover:border-gray-300'
                    }`}
                  >
                    N√£o
                  </button>
                  <button
                    type="button"
                    onClick={() => updateFormData({ gestanteAmamentando: 'N√£o se aplica' })}
                    className={`flex-1 px-4 py-3 border-2 rounded-xl font-medium transition-all ${
                      formData.gestanteAmamentando === 'N√£o se aplica'
                        ? `${coresTema.border500} ${coresTema.bg50} ${coresTema.text500}`
                        : 'border-gray-200 text-gray-700 hover:border-gray-300'
                    }`}
                  >
                    N/A
                  </button>
                </div>
                {fieldErrors.gestanteAmamentando && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.gestanteAmamentando}
                  </p>
                )}
              </div>
            </div>
          </div>
        );

      case 6:
        // Step 6: Expectativas e Objetivos
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Sparkles className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Expectativas e Objetivos</h3>
              <p className="text-gray-600 mt-2">O que voc√™ espera alcan√ßar?</p>
            </div>
            <div className="space-y-4">
              {/* Expectativas com o procedimento */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Expectativas com o procedimento <span className="text-red-500">*</span>
                </label>
                <textarea
                  rows={4}
                  placeholder="O que voc√™ espera alcan√ßar com este procedimento? *"
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.expectativasProcedimento ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.expectativasProcedimento || ''}
                  onChange={(e) => updateFormData({ expectativasProcedimento: e.target.value })}
                />
                {fieldErrors.expectativasProcedimento && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.expectativasProcedimento}
                  </p>
                )}
              </div>

              {/* Objetivos principais */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Objetivos principais <span className="text-red-500">*</span>
                </label>
                <textarea
                  rows={4}
                  placeholder="Ex: Rejuvenescimento, tratamento de acne, clareamento de manchas... *"
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.objetivosEstetica ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.objetivosEstetica || ''}
                  onChange={(e) => updateFormData({ objetivosEstetica: e.target.value })}
                />
                {fieldErrors.objetivosEstetica && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.objetivosEstetica}
                  </p>
                )}
              </div>
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  // ========== CONSULTORIA: Steps 2-4 ==========
  const renderStepConsultoria = () => {
    const iconBg = coresTema.bg50;
    const iconColor = coresTema.text500;

    switch (currentStep) {
      case 2:
        // Step 2: Perfil do Cliente
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Heart className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Perfil do Cliente</h3>
              <p className="text-gray-600 mt-2">Vamos conhecer suas prefer√™ncias</p>
            </div>
            <div className="space-y-4">
              {/* Categoria de interesse */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Categoria de interesse <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.categoriaInteresse ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.categoriaInteresse || ''}
                  onChange={(e) => updateFormData({ categoriaInteresse: e.target.value })}
                >
                  <option value="">Selecione a categoria *</option>
                  <option value="Cosm√©ticos">Cosm√©ticos</option>
                  <option value="Suplementos">Suplementos</option>
                  <option value="Vestu√°rio">Vestu√°rio</option>
                  <option value="Acess√≥rios">Acess√≥rios</option>
                  <option value="Produtos de Limpeza">Produtos de Limpeza</option>
                  <option value="Alimentos">Alimentos</option>
                  <option value="Tecnologia">Tecnologia</option>
                  <option value="Servi√ßos">Servi√ßos</option>
                  <option value="Outro">Outro</option>
                </select>
                {fieldErrors.categoriaInteresse && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.categoriaInteresse}
                  </p>
                )}
              </div>

              {/* Como conheceu (j√° existe no formData geral) */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Como conheceu voc√™/empresa? <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.comoConheceu ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.comoConheceu || ''}
                  onChange={(e) => updateFormData({ comoConheceu: e.target.value })}
                >
                  <option value="">Selecione *</option>
                  <option value="Instagram">Instagram</option>
                  <option value="Facebook">Facebook</option>
                  <option value="WhatsApp">WhatsApp</option>
                  <option value="Indica√ß√£o">Indica√ß√£o de conhecido</option>
                  <option value="Evento">Evento/Feira</option>
                  <option value="Site">Site/Google</option>
                  <option value="Outro">Outro</option>
                </select>
                {fieldErrors.comoConheceu && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.comoConheceu}
                  </p>
                )}
              </div>

              {/* Objetivo da compra */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Objetivo da compra
                </label>
                <textarea
                  rows={2}
                  placeholder="Ex: Uso pessoal, revenda, presente..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.objetivoCompra || ''}
                  onChange={(e) => updateFormData({ objetivoCompra: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 3:
        // Step 3: Prefer√™ncias e Hist√≥rico
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <FileText className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Prefer√™ncias e Hist√≥rico</h3>
              <p className="text-gray-600 mt-2">Suas experi√™ncias de compra</p>
            </div>
            <div className="space-y-4">
              {/* J√° comprou antes */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  J√° comprou antes? <span className="text-red-500">*</span>
                </label>
                <div className="flex gap-4">
                  <button
                    type="button"
                    onClick={() => updateFormData({ jaComprouAntes: 'Sim' })}
                    className={`flex-1 px-4 py-3 border-2 rounded-xl font-medium transition-all ${
                      formData.jaComprouAntes === 'Sim'
                        ? `${coresTema.border500} ${coresTema.bg50} ${coresTema.text500}`
                        : 'border-gray-200 text-gray-700 hover:border-gray-300'
                    }`}
                  >
                    ‚úì Sim
                  </button>
                  <button
                    type="button"
                    onClick={() => updateFormData({ jaComprouAntes: 'N√£o' })}
                    className={`flex-1 px-4 py-3 border-2 rounded-xl font-medium transition-all ${
                      formData.jaComprouAntes === 'N√£o'
                        ? `${coresTema.border500} ${coresTema.bg50} ${coresTema.text500}`
                        : 'border-gray-200 text-gray-700 hover:border-gray-300'
                    }`}
                  >
                    ‚úï N√£o
                  </button>
                </div>
                {fieldErrors.jaComprouAntes && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.jaComprouAntes}
                  </p>
                )}
              </div>

              {/* Produtos/servi√ßos de interesse */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Produtos/servi√ßos de interesse
                </label>
                <textarea
                  rows={3}
                  placeholder="Ex: Quais produtos tem interesse? Marcas preferidas?"
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.produtosInteresse || ''}
                  onChange={(e) => updateFormData({ produtosInteresse: e.target.value })}
                />
              </div>

              {/* Frequ√™ncia de compra */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Frequ√™ncia de compra estimada
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.frequenciaCompra || ''}
                  onChange={(e) => updateFormData({ frequenciaCompra: e.target.value })}
                >
                  <option value="">Selecione</option>
                  <option value="Semanal">Semanal</option>
                  <option value="Quinzenal">Quinzenal</option>
                  <option value="Mensal">Mensal</option>
                  <option value="Trimestral">Trimestral</option>
                  <option value="Semestral">Semestral</option>
                  <option value="Anual">Anual</option>
                  <option value="Eventual">Eventual</option>
                </select>
              </div>
            </div>
          </div>
        );

      case 4:
        // Step 4: Observa√ß√µes e Prefer√™ncias
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <Sparkles className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Observa√ß√µes e Prefer√™ncias</h3>
              <p className="text-gray-600 mt-2">Informa√ß√µes adicionais</p>
            </div>
            <div className="space-y-4">
              {/* Faixa de investimento */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Faixa de investimento mensal <span className="text-red-500">*</span>
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 ${
                    fieldErrors.faixaInvestimento ? 'border-red-500' : 'border-gray-200'
                  } rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.faixaInvestimento || ''}
                  onChange={(e) => updateFormData({ faixaInvestimento: e.target.value })}
                >
                  <option value="">Selecione *</option>
                  <option value="At√© R$ 100">At√© R$ 100</option>
                  <option value="R$ 100 - R$ 300">R$ 100 - R$ 300</option>
                  <option value="R$ 300 - R$ 500">R$ 300 - R$ 500</option>
                  <option value="R$ 500 - R$ 1.000">R$ 500 - R$ 1.000</option>
                  <option value="Acima de R$ 1.000">Acima de R$ 1.000</option>
                  <option value="Prefiro n√£o informar">Prefiro n√£o informar</option>
                </select>
                {fieldErrors.faixaInvestimento && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.faixaInvestimento}
                  </p>
                )}
              </div>

              {/* Prefer√™ncias de contato */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Prefer√™ncias de contato <span className="text-red-500">*</span>
                </label>
                <div className="grid grid-cols-2 gap-3">
                  {['WhatsApp', 'Telefone', 'Email', 'Redes Sociais'].map((opcao) => {
                    const preferencias = formData.preferenciasContato ? formData.preferenciasContato.split(',') : [];
                    const isSelected = preferencias.includes(opcao);

                    return (
                      <button
                        key={opcao}
                        type="button"
                        onClick={() => {
                          if (isSelected) {
                            const novasPreferencias = preferencias.filter(p => p !== opcao);
                            updateFormData({ preferenciasContato: novasPreferencias.join(',') });
                          } else {
                            updateFormData({ preferenciasContato: [...preferencias, opcao].join(',') });
                          }
                        }}
                        className={`px-4 py-3 border-2 rounded-xl font-medium transition-all ${
                          isSelected
                            ? `${coresTema.border500} ${coresTema.bg50} ${coresTema.text500}`
                            : 'border-gray-200 text-gray-700 hover:border-gray-300'
                        }`}
                      >
                        {isSelected ? '‚úì ' : ''}{opcao}
                      </button>
                    );
                  })}
                </div>
                {fieldErrors.preferenciasContato && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.preferenciasContato}
                  </p>
                )}
              </div>

              {/* Observa√ß√µes gerais */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Observa√ß√µes gerais
                </label>
                <textarea
                  rows={4}
                  placeholder="Ex: Restri√ß√µes, prefer√™ncias, informa√ß√µes adicionais..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors resize-none`}
                  value={formData.observacoesGerais || ''}
                  onChange={(e) => updateFormData({ observacoesGerais: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  // Renderizar etapa atual
  const renderStep = () => {
    // ‚úÖ IMPORTANTE: √öltimo step (Termo) SEMPRE usa a fun√ß√£o renderTermoDeCompromisso()
    if (currentStep === totalSteps) {
      return renderTermoDeCompromisso();
    }

    // ‚úÖ PEN√öLTIMO STEP: Data da Anamnese + Valor do Procedimento
    if (currentStep === totalSteps - 1) {
      return renderDataAnamnese();
    }

    // üìù STEP 2: Perguntas Customizadas do Template (se existir template ativo)
    if (currentStep === 2 && templateAtivo && templateAtivo.perguntas.length > 0) {
      return (
        <div className={`${coresTema.bg50} p-8 rounded-2xl`}>
          <div className="mb-6">
            <h3 className="text-xl font-bold text-gray-900 mb-2">üìã Question√°rio Personalizado</h3>
            <p className="text-gray-600">Responda as perguntas abaixo</p>
          </div>

          <TemplateQuizRenderer
            perguntas={templateAtivo.perguntas}
            respostas={respostasCustomizadas}
            onChange={(perguntaId, resposta) => {
              setRespostasCustomizadas(prev => ({
                ...prev,
                [perguntaId]: resposta
              }));
            }}
            errors={fieldErrors}
          />
        </div>
      );
    }

    // Se usa quiz customizado, renderizar steps customizados
    if (useCustomQuiz) {
      return renderCustomStep();
    }

    // ü•ó NUTRI√á√ÉO: Steps 2-6 s√£o perguntas de nutri√ß√£o (Step 7 data + Step 8 termo)
    const profissao = localStorage.getItem('anamneseConfig') ? JSON.parse(localStorage.getItem('anamneseConfig')!).templateProfissao : 'tatuagem';
    if (profissao === 'nutricao' && currentStep >= 2 && currentStep <= 6) {
      return renderStepNutricao();
    }

    // üß† PSICOLOGIA: Steps 2-5 s√£o perguntas de psicologia (Step 6 data + Step 7 termo)
    if (profissao === 'psicologia' && currentStep >= 2 && currentStep <= 5) {
      return renderStepPsicologia();
    }

    // üí™ FISIOTERAPIA: Steps 2-6 s√£o perguntas de fisioterapia (Step 7 data + Step 8 termo)
    if (profissao === 'fisioterapia' && currentStep >= 2 && currentStep <= 6) {
      return renderStepFisioterapia();
    }

    // ‚ú® EST√âTICA: Steps 2-6 s√£o perguntas de est√©tica (Step 7 data + Step 8 termo)
    if (profissao === 'estetica' && currentStep >= 2 && currentStep <= 6) {
      return renderStepEstetica();
    }

    // üíº CONSULTORIA: Steps 2-4 s√£o perguntas de consultoria (Step 5 data + Step 6 termo)
    if (profissao === 'consultoria' && currentStep >= 2 && currentStep <= 4) {
      return renderStepConsultoria();
    }

    // üíâ TATUAGEM: Steps 1-7 (Step 8 data + Step 9 termo)
    switch (currentStep) {
      case 1:
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <StepIcon className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Dados Pessoais</h3>
              <p className="text-gray-600 mt-2">Vamos come√ßar com suas informa√ß√µes b√°sicas</p>
            </div>
            <div className="space-y-4">
              {/* Nome Completo */}
              <div>
                <input
                  type="text"
                  placeholder="Nome completo *"
                  className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                    fieldErrors.nomeCompleto ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                  }`}
                  value={formData.nomeCompleto || ''}
                  onChange={(e) => updateFormData({ nomeCompleto: e.target.value })}
                />
                {fieldErrors.nomeCompleto && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.nomeCompleto}
                  </p>
                )}
              </div>

              <div className="grid grid-cols-2 gap-3">
                {/* Data de Nascimento */}
                <div>
                  <label className="text-xs text-gray-600 mb-1 block">Data de nascimento <span className="text-red-500">*</span></label>
                  <input
                    type="date"
                    className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                      fieldErrors.dataNascimento ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                    }`}
                    value={formData.dataNascimento || ''}
                    onChange={(e) => updateFormData({ dataNascimento: e.target.value })}
                  />
                  {fieldErrors.dataNascimento && (
                    <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                      ‚ö†Ô∏è {fieldErrors.dataNascimento}
                    </p>
                  )}
                </div>

                {/* CPF */}
                <div>
                  <input
                    type="text"
                    placeholder="CPF *"
                    className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                      fieldErrors.cpf ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                    }`}
                    value={formData.cpf || ''}
                    onChange={(e) => updateFormData({ cpf: e.target.value })}
                  />
                  {fieldErrors.cpf && (
                    <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                      ‚ö†Ô∏è {fieldErrors.cpf}
                    </p>
                  )}
                </div>
              </div>

              {/* Telefone */}
              <div>
                <input
                  type="tel"
                  placeholder="Telefone *"
                  className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                    fieldErrors.telefone ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                  }`}
                  value={formData.telefone || ''}
                  onChange={(e) => updateFormData({ telefone: e.target.value })}
                />
                {fieldErrors.telefone && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.telefone}
                  </p>
                )}
              </div>

              {/* Email */}
              <div>
                <input
                  type="email"
                  placeholder="E-mail *"
                  className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                    fieldErrors.email ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                  }`}
                  value={formData.email || ''}
                  onChange={(e) => updateFormData({ email: e.target.value })}
                />
                {fieldErrors.email && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.email}
                  </p>
                )}
              </div>

              {/* CEP com busca autom√°tica */}
              <div>
                <div className="relative">
                  <input
                    type="text"
                    placeholder="CEP (somente n√∫meros) *"
                    maxLength={8}
                    className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                      fieldErrors.cep ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                    }`}
                    value={formData.cep || ''}
                    onChange={(e) => {
                      const cep = e.target.value.replace(/\D/g, '');
                      updateFormData({ cep });
                      if (cep.length === 8) {
                        buscarCEP(cep);
                      }
                    }}
                  />
                  {formData.cep && formData.cep.length === 8 && (
                    <span className="absolute right-3 top-3 text-green-500">‚úì</span>
                  )}
                </div>
                {fieldErrors.cep && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.cep}
                  </p>
                )}
                <p className="text-xs text-gray-500 mt-1">Digite o CEP para preencher automaticamente</p>
              </div>

              {/* Grid de endere√ßo - Rua e N√∫mero */}
              <div className="grid grid-cols-3 gap-3">
                <div className="col-span-2">
                  <input
                    type="text"
                    placeholder="Rua *"
                    className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                      fieldErrors.rua ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                    }`}
                    value={formData.rua || ''}
                    onChange={(e) => updateFormData({ rua: e.target.value })}
                  />
                  {fieldErrors.rua && (
                    <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                      ‚ö†Ô∏è {fieldErrors.rua}
                    </p>
                  )}
                </div>
                <div>
                  <input
                    type="text"
                    placeholder="N√∫mero *"
                    className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                      fieldErrors.numero ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                    }`}
                    value={formData.numero || ''}
                    onChange={(e) => updateFormData({ numero: e.target.value })}
                  />
                  {fieldErrors.numero && (
                    <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                      ‚ö†Ô∏è {fieldErrors.numero}
                    </p>
                  )}
                </div>
              </div>

              {/* Complemento */}
              <div>
                <input
                  type="text"
                  placeholder="Complemento (opcional)"
                  className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors border-gray-200 ${coresTema.focus}`}
                  value={formData.complemento || ''}
                  onChange={(e) => updateFormData({ complemento: e.target.value })}
                />
              </div>

              {/* Grid de endere√ßo - Bairro, Cidade e Estado */}
              <div className="grid grid-cols-3 gap-3">
                <div>
                  <input
                    type="text"
                    placeholder="Bairro *"
                    className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                      fieldErrors.bairro ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                    }`}
                    value={formData.bairro || ''}
                    onChange={(e) => updateFormData({ bairro: e.target.value })}
                  />
                  {fieldErrors.bairro && (
                    <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                      ‚ö†Ô∏è {fieldErrors.bairro}
                    </p>
                  )}
                </div>
                <div>
                  <input
                    type="text"
                    placeholder="Cidade *"
                    className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors ${
                      fieldErrors.cidade ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                    }`}
                    value={formData.cidade || ''}
                    onChange={(e) => updateFormData({ cidade: e.target.value })}
                  />
                  {fieldErrors.cidade && (
                    <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                      ‚ö†Ô∏è {fieldErrors.cidade}
                    </p>
                  )}
                </div>
                <div>
                  <input
                    type="text"
                    placeholder="UF *"
                    maxLength={2}
                    className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors uppercase ${
                      fieldErrors.estado ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                    }`}
                    value={formData.estado || ''}
                    onChange={(e) => updateFormData({ estado: e.target.value.toUpperCase() })}
                  />
                  {fieldErrors.estado && (
                    <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                      ‚ö†Ô∏è {fieldErrors.estado}
                    </p>
                  )}
                </div>
              </div>
            </div>
          </div>
        );

      case 2:
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <StepIcon className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Como me conheceu? <span className="text-red-500">*</span></h3>
              <p className="text-gray-600 mt-2">Selecione como chegou at√© n√≥s</p>
            </div>
            <div className="grid grid-cols-2 gap-3">
              {[
                { value: 'Instagram', emoji: 'üì±' },
                { value: 'Google', emoji: 'üîç' },
                { value: 'Indica√ß√£o', emoji: 'üë•' },
                { value: 'Outro', emoji: 'üí°' }
              ].map((option) => (
                <button
                  key={option.value}
                  onClick={() => updateFormData({ comoConheceu: option.value })}
                  className={`px-6 py-4 rounded-xl border-2 transition-all text-center ${
                    formData.comoConheceu === option.value
                      ? `${coresTema.border500} ${coresTema.bg50} shadow-lg scale-105`
                      : `border-gray-200 ${coresTema.hover} ${coresTema.hoverBg}`
                  }`}
                >
                  <div className="text-3xl mb-2">{option.emoji}</div>
                  <div className="text-sm font-medium text-gray-900">{option.value}</div>
                </button>
              ))}
            </div>
            {fieldErrors.comoConheceu && (
              <p className="text-red-500 text-sm mt-2 flex items-center gap-1">
                ‚ö†Ô∏è {fieldErrors.comoConheceu}
              </p>
            )}
            {formData.comoConheceu === 'Outro' && (
              <div>
                <input
                  type="text"
                  placeholder="Especifique... *"
                  className={`w-full px-4 py-3 border-2 rounded-xl text-gray-900 focus:outline-none transition-colors mt-4 ${
                    fieldErrors.outraOrigem ? 'border-red-500 focus:border-red-500' : `border-gray-200 ${coresTema.focus}`
                  }`}
                  value={formData.outraOrigem || ''}
                  onChange={(e) => updateFormData({ outraOrigem: e.target.value })}
                />
                {fieldErrors.outraOrigem && (
                  <p className="text-red-500 text-sm mt-1 flex items-center gap-1">
                    ‚ö†Ô∏è {fieldErrors.outraOrigem}
                  </p>
                )}
              </div>
            )}
          </div>
        );

      case 3:
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <StepIcon className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Sa√∫de Geral</h3>
              <p className="text-gray-600 mt-2">Informa√ß√µes importantes sobre sua sa√∫de</p>
            </div>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Possui alguma doen√ßa ou condi√ß√£o de sa√∫de?
                </label>
                <textarea
                  placeholder="Descreva aqui... (Ex: diabetes, hipertens√£o, etc)"
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors min-h-[100px] resize-none`}
                  value={formData.doencas || ''}
                  onChange={(e) => updateFormData({ doencas: e.target.value })}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Usa algum medicamento atualmente?
                </label>
                <textarea
                  placeholder="Liste os medicamentos... (Ex: Losartana 50mg, etc)"
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors min-h-[100px] resize-none`}
                  value={formData.medicamentos || ''}
                  onChange={(e) => updateFormData({ medicamentos: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      case 4:
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <StepIcon className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Alergias</h3>
              <p className="text-gray-600 mt-2">Possui alguma alergia conhecida?</p>
            </div>
            <div className="space-y-4">
              <div className="grid grid-cols-2 gap-3">
                <button
                  onClick={() => updateFormData({ temAlergias: true })}
                  className={`px-6 py-4 rounded-xl border-2 transition-all ${
                    formData.temAlergias === true
                      ? `${coresTema.border500} ${coresTema.bg50} shadow-lg scale-105`
                      : `border-gray-200 ${coresTema.hover}`
                  }`}
                >
                  <div className="text-2xl mb-1">‚úÖ</div>
                  <div className="text-sm font-medium text-gray-900">Sim, tenho</div>
                </button>
                <button
                  onClick={() => updateFormData({ temAlergias: false, alergias: '' })}
                  className={`px-6 py-4 rounded-xl border-2 transition-all ${
                    formData.temAlergias === false
                      ? `${coresTema.border500} ${coresTema.bg50} shadow-lg scale-105`
                      : `border-gray-200 ${coresTema.hover}`
                  }`}
                >
                  <div className="text-2xl mb-1">‚ùå</div>
                  <div className="text-sm font-medium text-gray-900">N√£o tenho</div>
                </button>
              </div>
              {formData.temAlergias && (
                <div className="mt-4">
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Quais alergias?
                  </label>
                  <textarea
                    placeholder="Descreva suas alergias... (Ex: tinta, metais, l√°tex, etc)"
                    className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors min-h-[100px] resize-none`}
                    value={formData.alergias || ''}
                    onChange={(e) => updateFormData({ alergias: e.target.value })}
                  />
                </div>
              )}
            </div>
          </div>
        );

      case 5:
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <StepIcon className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Condi√ß√µes de Pele</h3>
              <p className="text-gray-600 mt-2">Como est√° sua pele atualmente?</p>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Possui alguma condi√ß√£o de pele? (dermatites, queloides, cicatriza√ß√£o lenta, etc)
              </label>
              <textarea
                placeholder="Descreva aqui..."
                className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors min-h-[120px] resize-none`}
                value={formData.condicoesPele || ''}
                onChange={(e) => updateFormData({ condicoesPele: e.target.value })}
              />
            </div>
          </div>
        );

      case 6:
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <StepIcon className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Hist√≥rico de Tatuagens</h3>
              <p className="text-gray-600 mt-2">J√° fez tatuagem antes?</p>
            </div>
            <div className="space-y-4">
              <div className="grid grid-cols-2 gap-3">
                <button
                  onClick={() => updateFormData({ temTatuagem: true })}
                  className={`px-6 py-4 rounded-xl border-2 transition-all ${
                    formData.temTatuagem === true
                      ? `${coresTema.border500} ${coresTema.bg50} shadow-lg scale-105`
                      : `border-gray-200 ${coresTema.hover}`
                  }`}
                >
                  <div className="text-2xl mb-1">‚úÖ</div>
                  <div className="text-sm font-medium text-gray-900">Sim, j√° fiz</div>
                </button>
                <button
                  onClick={() => updateFormData({ temTatuagem: false, historicoTatuagens: '' })}
                  className={`px-6 py-4 rounded-xl border-2 transition-all ${
                    formData.temTatuagem === false
                      ? `${coresTema.border500} ${coresTema.bg50} shadow-lg scale-105`
                      : `border-gray-200 ${coresTema.hover}`
                  }`}
                >
                  <div className="text-2xl mb-1">üÜï</div>
                  <div className="text-sm font-medium text-gray-900">Primeira vez</div>
                </button>
              </div>
              {formData.temTatuagem && (
                <div className="mt-4">
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Conte sobre suas tatuagens anteriores
                  </label>
                  <textarea
                    placeholder="Quantas? Onde? Teve algum problema?"
                    className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors min-h-[100px] resize-none`}
                    value={formData.historicoTatuagens || ''}
                    onChange={(e) => updateFormData({ historicoTatuagens: e.target.value })}
                  />
                </div>
              )}
            </div>
          </div>
        );

      case 7:
        return (
          <div className="space-y-5 animate-fadeIn">
            <div className="text-center mb-6">
              <div className={`w-16 h-16 ${iconBg} rounded-full flex items-center justify-center mx-auto mb-3`}>
                <StepIcon className={`h-8 w-8 ${iconColor}`} />
              </div>
              <h3 className="text-2xl font-bold text-gray-900">Sobre a Nova Tatuagem</h3>
              <p className="text-gray-600 mt-2">Detalhes do procedimento desejado</p>
            </div>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Onde ser√° a tatuagem?
                </label>
                <input
                  type="text"
                  placeholder="Ex: Bra√ßo direito, costas, perna esquerda..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.localTatuagem || ''}
                  onChange={(e) => updateFormData({ localTatuagem: e.target.value })}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Qual o tamanho aproximado?
                </label>
                <select
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.tamanhoTatuagem || ''}
                  onChange={(e) => updateFormData({ tamanhoTatuagem: e.target.value })}
                >
                  <option value="">Selecione...</option>
                  <option value="Pequena (at√© 5cm)">Pequena (at√© 5cm)</option>
                  <option value="M√©dia (5-15cm)">M√©dia (5-15cm)</option>
                  <option value="Grande (15-30cm)">Grande (15-30cm)</option>
                  <option value="Extra Grande (30cm+)">Extra Grande (30cm+)</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Estilo desejado
                </label>
                <input
                  type="text"
                  placeholder="Ex: Realista, tradicional, aquarela, minimalista..."
                  className={`w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-gray-900 ${coresTema.focus} focus:outline-none transition-colors`}
                  value={formData.estiloTatuagem || ''}
                  onChange={(e) => updateFormData({ estiloTatuagem: e.target.value })}
                />
              </div>
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
        {/* Header com bot√£o fechar */}
        <div className={`bg-gradient-to-r ${coresTema.gradient} p-6 relative`}>
          <button
            onClick={onClose}
            className="absolute top-4 right-4 w-10 h-10 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition-colors"
          >
            <X className="h-5 w-5 text-white" />
          </button>
          <div className="text-white">
            <div className="text-sm font-medium opacity-90">
              Etapa {currentStep} de {totalSteps} ‚Ä¢ Modo: {mode === 'presencial' ? 'Presencial' : 'Remoto'}
            </div>
            <div className="text-2xl font-bold mt-1">Quiz de Anamnese</div>

            {/* Bot√£o "Alterar Dados Anteriores" - Aparece quando √© cliente retornando */}
            {initialData && currentStep >= 7 && (
              <button
                onClick={() => setCurrentStep(1)}
                className="mt-3 px-4 py-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-lg flex items-center gap-2 text-sm font-medium transition-colors"
              >
                <ChevronLeft className="h-4 w-4" />
                Alterar Dados Anteriores
              </button>
            )}
          </div>
          <Progress value={progress} className="mt-4 h-2 bg-white/30" />
        </div>

        {/* Conte√∫do */}
        <div className="p-6 overflow-y-auto max-h-[calc(90vh-280px)]">
          {renderStep()}
        </div>

        {/* Footer com bot√µes */}
        <div className="border-t border-gray-200 p-4 flex gap-3">
          <button
            onClick={handlePrevious}
            disabled={currentStep === 1}
            className="flex-1 px-6 py-3 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 font-medium rounded-xl transition-colors flex items-center justify-center gap-2 disabled:cursor-not-allowed"
          >
            <ChevronLeft className="h-5 w-5" />
            Voltar
          </button>
          {currentStep < totalSteps ? (
            <button
              onClick={handleNext}
              className={`flex-1 px-6 py-3 bg-gradient-to-r ${coresTema.gradient} text-white font-medium rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl`}
            >
              Avan√ßar
              <ChevronRight className="h-5 w-5" />
            </button>
          ) : (
            <button
              onClick={handleComplete}
              disabled={!formData.aceitaTermo || !formData.assinatura}
              className="flex-1 px-6 py-3 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-600 hover:to-green-600 disabled:from-gray-300 disabled:to-gray-400 text-white font-medium rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl disabled:cursor-not-allowed"
            >
              <CheckCircle className="h-5 w-5" />
              {mode === 'remoto' ? 'Gerar Link para Cliente' : 'Finalizar e Salvar'}
            </button>
          )}
        </div>
      </div>

      <style>{`
        @keyframes fadeIn {
          from { opacity: 0; transform: scale(0.95); }
          to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
      `}</style>
    </div>
  );
}
